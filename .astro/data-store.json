[["Map",1,2,9,10,107,108],"meta::meta",["Map",3,4,5,6,7,8],"astro-version","5.16.6","content-config-digest","1d02cc832b5bd0e0","astro-config-digest","{\"root\":{},\"srcDir\":{},\"publicDir\":{},\"outDir\":{},\"cacheDir\":{},\"site\":\"https://lakshchakraborty.com\",\"compressHTML\":true,\"base\":\"/\",\"trailingSlash\":\"ignore\",\"output\":\"static\",\"scopedStyleStrategy\":\"attribute\",\"build\":{\"format\":\"directory\",\"client\":{},\"server\":{},\"assets\":\"_astro\",\"serverEntry\":\"entry.mjs\",\"redirects\":true,\"inlineStylesheets\":\"auto\",\"concurrency\":1},\"server\":{\"open\":false,\"host\":false,\"port\":4321,\"streaming\":true,\"allowedHosts\":[]},\"redirects\":{},\"image\":{\"endpoint\":{\"route\":\"/_image\"},\"service\":{\"entrypoint\":\"astro/assets/services/sharp\",\"config\":{}},\"domains\":[],\"remotePatterns\":[],\"responsiveStyles\":false},\"devToolbar\":{\"enabled\":true},\"markdown\":{\"syntaxHighlight\":{\"type\":\"shiki\",\"excludeLangs\":[\"math\"]},\"shikiConfig\":{\"langs\":[],\"langAlias\":{},\"theme\":\"github-dark\",\"themes\":{},\"wrap\":false,\"transformers\":[]},\"remarkPlugins\":[],\"rehypePlugins\":[],\"remarkRehype\":{},\"gfm\":true,\"smartypants\":true},\"security\":{\"checkOrigin\":true,\"allowedDomains\":[]},\"env\":{\"schema\":{},\"validateSecrets\":false},\"experimental\":{\"clientPrerender\":false,\"contentIntellisense\":false,\"headingIdCompat\":false,\"preserveScriptOrder\":false,\"liveContentCollections\":false,\"csp\":false,\"staticImportMetaEnv\":false,\"chromeDevtoolsWorkspace\":false,\"failOnPrerenderConflict\":false,\"svgo\":false},\"legacy\":{\"collections\":false}}","blog",["Map",11,12,36,37,74,75],"value-types",{"id":11,"data":13,"body":23,"filePath":24,"digest":25,"rendered":26,"legacyId":35},{"title":14,"subtitle":15,"description":16,"publishDate":17,"pubDate":17,"draft":18,"colors":19},"Value Types: The Swift Conundrum","How did we get here?","","11/12/23",true,{"b1":20,"b2":21,"b3":22},"bg-sky-300","bg-cyan-300","bg-blue-300","Lorem ipsum dolor sit amet, officia excepteur ex fugiat reprehenderit enim labore culpa sint ad nisi Lorem pariatur mollit ex esse exercitation amet. Nisi anim cupidatat excepteur officia. Reprehenderit nostrud nostrud ipsum Lorem est aliquip amet voluptate voluptate dolor minim nulla est proident. Nostrud officia pariatur ut officia. Sit irure elit esse ea nulla sunt ex occaecat reprehenderit commodo officia dolor Lorem duis laboris cupidatat officia voluptate. Culpa proident adipisicing id nulla nisi laboris ex in Lorem sunt duis officia eiusmod. Aliqua reprehenderit commodo ex non excepteur duis sunt velit enim. Voluptate laboris sint cupidatat ullamco ut ea consectetur et est culpa et culpa duis.\n\nLorem ipsum dolor sit amet, officia excepteur ex fugiat reprehenderit enim labore culpa sint ad nisi Lorem pariatur mollit ex esse exercitation amet. Nisi anim cupidatat excepteur officia. Reprehenderit nostrud nostrud ipsum Lorem est aliquip amet voluptate voluptate dolor minim nulla est proident. Nostrud officia pariatur ut officia. Sit irure elit esse ea nulla sunt ex occaecat reprehenderit commodo officia dolor Lorem duis laboris cupidatat officia voluptate. Culpa proident adipisicing id nulla nisi laboris ex in Lorem sunt duis officia eiusmod. Aliqua reprehenderit commodo ex non excepteur duis sunt velit enim. Voluptate laboris sint cupidatat ullamco ut ea consectetur et est culpa et culpa duis.\n\nLorem ipsum dolor sit amet, officia excepteur ex fugiat reprehenderit enim labore culpa sint ad nisi Lorem pariatur mollit ex esse exercitation amet. Nisi anim cupidatat excepteur officia. Reprehenderit nostrud nostrud ipsum Lorem est aliquip amet voluptate voluptate dolor minim nulla est proident. Nostrud officia pariatur ut officia. Sit irure elit esse ea nulla sunt ex occaecat reprehenderit commodo officia dolor Lorem duis laboris cupidatat officia voluptate. Culpa proident adipisicing id nulla nisi laboris ex in Lorem sunt duis officia eiusmod. Aliqua reprehenderit commodo ex non excepteur duis sunt velit enim. Voluptate laboris sint cupidatat ullamco ut ea consectetur et est culpa et culpa duis.\n\nLorem ipsum dolor sit amet, officia excepteur ex fugiat reprehenderit enim labore culpa sint ad nisi Lorem pariatur mollit ex esse exercitation amet. Nisi anim cupidatat excepteur officia. Reprehenderit nostrud nostrud ipsum Lorem est aliquip amet voluptate voluptate dolor minim nulla est proident. Nostrud officia pariatur ut officia. Sit irure elit esse ea nulla sunt ex occaecat reprehenderit commodo officia dolor Lorem duis laboris cupidatat officia voluptate. Culpa proident adipisicing id nulla nisi laboris ex in Lorem sunt duis officia eiusmod. Aliqua reprehenderit commodo ex non excepteur duis sunt velit enim. Voluptate laboris sint cupidatat ullamco ut ea consectetur et est culpa et culpa duis.","src/content/blog/value-types.md","e8a5bd9aa12233b1",{"html":27,"metadata":28},"\u003Cp>Lorem ipsum dolor sit amet, officia excepteur ex fugiat reprehenderit enim labore culpa sint ad nisi Lorem pariatur mollit ex esse exercitation amet. Nisi anim cupidatat excepteur officia. Reprehenderit nostrud nostrud ipsum Lorem est aliquip amet voluptate voluptate dolor minim nulla est proident. Nostrud officia pariatur ut officia. Sit irure elit esse ea nulla sunt ex occaecat reprehenderit commodo officia dolor Lorem duis laboris cupidatat officia voluptate. Culpa proident adipisicing id nulla nisi laboris ex in Lorem sunt duis officia eiusmod. Aliqua reprehenderit commodo ex non excepteur duis sunt velit enim. Voluptate laboris sint cupidatat ullamco ut ea consectetur et est culpa et culpa duis.\u003C/p>\n\u003Cp>Lorem ipsum dolor sit amet, officia excepteur ex fugiat reprehenderit enim labore culpa sint ad nisi Lorem pariatur mollit ex esse exercitation amet. Nisi anim cupidatat excepteur officia. Reprehenderit nostrud nostrud ipsum Lorem est aliquip amet voluptate voluptate dolor minim nulla est proident. Nostrud officia pariatur ut officia. Sit irure elit esse ea nulla sunt ex occaecat reprehenderit commodo officia dolor Lorem duis laboris cupidatat officia voluptate. Culpa proident adipisicing id nulla nisi laboris ex in Lorem sunt duis officia eiusmod. Aliqua reprehenderit commodo ex non excepteur duis sunt velit enim. Voluptate laboris sint cupidatat ullamco ut ea consectetur et est culpa et culpa duis.\u003C/p>\n\u003Cp>Lorem ipsum dolor sit amet, officia excepteur ex fugiat reprehenderit enim labore culpa sint ad nisi Lorem pariatur mollit ex esse exercitation amet. Nisi anim cupidatat excepteur officia. Reprehenderit nostrud nostrud ipsum Lorem est aliquip amet voluptate voluptate dolor minim nulla est proident. Nostrud officia pariatur ut officia. Sit irure elit esse ea nulla sunt ex occaecat reprehenderit commodo officia dolor Lorem duis laboris cupidatat officia voluptate. Culpa proident adipisicing id nulla nisi laboris ex in Lorem sunt duis officia eiusmod. Aliqua reprehenderit commodo ex non excepteur duis sunt velit enim. Voluptate laboris sint cupidatat ullamco ut ea consectetur et est culpa et culpa duis.\u003C/p>\n\u003Cp>Lorem ipsum dolor sit amet, officia excepteur ex fugiat reprehenderit enim labore culpa sint ad nisi Lorem pariatur mollit ex esse exercitation amet. Nisi anim cupidatat excepteur officia. Reprehenderit nostrud nostrud ipsum Lorem est aliquip amet voluptate voluptate dolor minim nulla est proident. Nostrud officia pariatur ut officia. Sit irure elit esse ea nulla sunt ex occaecat reprehenderit commodo officia dolor Lorem duis laboris cupidatat officia voluptate. Culpa proident adipisicing id nulla nisi laboris ex in Lorem sunt duis officia eiusmod. Aliqua reprehenderit commodo ex non excepteur duis sunt velit enim. Voluptate laboris sint cupidatat ullamco ut ea consectetur et est culpa et culpa duis.\u003C/p>",{"headings":29,"localImagePaths":30,"remoteImagePaths":31,"frontmatter":32,"imagePaths":34},[],[],[],{"title":14,"subtitle":15,"colors":33,"publishDate":17,"pubDate":17,"draft":18},{"b1":20,"b2":21,"b3":22},[],"value-types.md","building-sheet-1",{"id":36,"data":38,"body":47,"filePath":48,"digest":49,"rendered":50,"legacyId":73},{"title":39,"subtitle":40,"description":16,"publishDate":41,"pubDate":41,"draft":42,"colors":43},"SwiftUI API Design: Sheet I","This series of posts will take you through not only how to make a sheet modifier in SwiftUI, but also how to think about SwiftUI API design, and how Apple seems to approach it. Along the way, I'll show you a few fun SwiftUI tricks that can help make your code more modular and more readable!","04/05/24",false,{"b1":44,"b2":45,"b3":46},"bg-sky-200","bg-cyan-200","bg-blue-200","You’re looking at that title and probably thinking, “not another gosh darn SwiftUI bottom sheet implementation!” And to that I’d say that you’re probably right to be skeptical. However, I think this series of posts could be worth your while. This isn’t just about  `.sheet`, it’s about SwiftUI API design. I will try to keep my final implementation as close as possible to the Apple version as possible, and try to peel back how they achieve the API they have.\n\n---- \n\n# SwiftUI Sheet\n\nLet’s begin with an exploration of the native `.sheet` modifier, and see how it works.\n\nSwiftUI’s `.sheet` modifier defined on `View`, and has two initializers:\n```swift\n// 1\n.sheet(\n    isPresented: Binding\u003CBool>,\n    onDismiss: (() -> Void)?,\n    content: () -> View\n) -> View\n\n// 2\n.sheet(\n    item: Binding\u003CIdentifiable?>,\n    onDismiss: (() -> Void)?,\n    content: (Identifiable) -> View\n) -> View\n```\n\nThe first is simpler than the second. In the first initializer, sheet takes a boolean `Binding`, which determines whether the sheet is shown or not. When the value of `isPresented` is set to `true`, the view built by the `content` view builder is presented. When it is set to `false`, the sheet is dismissed.\n\nThe second initializer, instead of taking a boolean `Binding`, takes a `Binding` to an _optional_ `Identifiable` value. When the optional value is non-nil, the view built by the `content` view builder is presented. The view builder takes as a parameter the non-optional version of the binding’s value. For example, if you pass a `Binding\u003CCustomItem?>`for `item`, the content view builder would take a `CustomItem` as a parameter (`(CustomItem) -> View` would be the signature.)\n\nBoth initializers also have an optional `onDismiss` closure that is triggered when the view is dismissed with by a system behavior, for example, a downward swipe on iOS or iPadOS. This is why we have a `Binding` to the item value and the isPresented value: the sheet needs to be dismissible by SwiftUI. If it is dismissed, it updates `isPresented` and `item` accordingly.\n\nBut why does `.sheet` look like this? It's all about progressive disclosure: the idea that common cases should have simple call sites, but there should be more power if developers need it.[^1] The first initializer is a perfect example of keeping the callsite simple. All you need is this:\n```swift\n.sheet(isPresented: $isPresented) {\n    Text(\"Hello World\")\n}\n```\n\nBut if you need more control, you can do this:\n```swift\n.sheet(item: $item, onDismiss: {\n    print(\"Sheet dismissed!\")\n}) { item in\n    Text(item.text)\n}\n```\n\nSwiftUI also embraces composability instead of enumeration. Instead of adding all of sheet's options to the `.sheet` modifier itself, SwiftUI opts to put them into supplementary view modifiers, like `.presentationCornerRadius` and `.presentationDetents`. This is what a cluttered API would look like:\n```swift\n.sheet(\n    item: $item,\n    presentationCornerRadius: 50,\n    presentationDetents: [.medium, .large],\n    onDismiss: {\n        print(\"Sheet dismissed!\")\n    }\n) { item in\n    Text(item.text)\n}\n```\n\nInstead, SwiftUI does this:\n```swift\n.sheet(\n    item: $item,\n    onDismiss: {\n        print(\"Sheet dismissed!\")\n    }\n) { item in\n    Text(item.text)\n        .presentationCornerRadius(50)\n        .presentationDetents([.medium, .large])\n}\n```\n\nThat might not seem like much, but it quickly adds up. This also allows the SwiftUI team to add more functionality to sheets without breaking changes. Just add a new view modifier! We'll explore this more thoroughly in future parts of this series.\n\nFor now, let's implement the simple case.\n\n---- \n\n# A Rough Implementation\n\nFirst, let us see what look we are targeting for our new sheet modifier. We’re going to try and recreate this sheet that apple uses for many of its apps, including spacial audio, and to show AirPods battery status.\n\n![The sheet we're attempting to replicate. A sheet with the title \"Personalized Spatial Audio,\" which has two buttons at the bottom, titled \"Get Started\" and \"Not Now\"](/images/blog/sheet-1/spatial_audio.jpg)\n\nFirst, let’s try to achieve the style with no view modifiers. Just VStacks and ZStacks.\n\nI wrote a simple View that will be my sheet’s content, trying to match the screenshot above. It’s not important to this post, but here’s [the code](https://github.com/reftonull/ExploringSheet/blob/main/SheetExploration/ContentView.swift). This is what it looks like:\n![The above sheet as a SwiftUI View](/images/blog/sheet-1/inner_view.png)\n\nNow we move to the actual sheet. \n\nWe begin with a simple base View on top of which we’ll put our sheet:\n```swift\nstruct ContentView: View {\n    @State var isPresented: Bool = false // 1\n        \n    var body: some View {\n       \tScrollView {\n            VStack {\n                Image(systemName: \"globe\")\n                    .imageScale(.large)\n                    .foregroundStyle(.tint)\n                Text(\"Hello, world!\")\n                Button(\"Present Sheet\") {\n                    isPresented = true\n                }\n            }\n            .padding()\n        }\n        .frame(maxWidth: .infinity)\n\t}\n}\n```\n\n1. `isPresented` is the binding we will eventually pass into our custom sheet modifier.\n  \nNext, we wrap the whole thing in a ZStack and add our sheet conditionally, based on isPresented:\n```swift\nstruct ContentView: View {\n    @State var isPresented: Bool = false\n    @State var offset: CGFloat = 0\n    \n    var body: some View {\n        ZStack(alignment: .bottom) {\n            ScrollView {\n                VStack {\n                    Image(systemName: \"globe\")\n                        .imageScale(.large)\n                        .foregroundStyle(.tint)\n                    Text(\"Hello, world!\")\n                    Button(\"Present Sheet\") {\n                        isPresented = true\n                    }\n                }\n            \t.frame(maxWidth: .infinity)\n                .padding()\n            }\n            .overlay { // 10\n                Color.black.opacity(isPresented ? 0.3 : 0.0)\n            }\n\n            if isPresented {\n                InnerView() // 1\n                    .background(.background.secondary, in: .rect(cornerRadius: 50)) // 2\n                    .padding(4)\n                    .gesture( // 3\n                        DragGesture(coordinateSpace: .global)\n                            .onChanged { value in\n                                offset = clip (\n                                    value: value.translation.height,\n                                    lower: -30,\n                                    upper: .infinity\n                                )\n                            }\n                            .onEnded { value in\n                                if value.translation.height > 30 {\n                                    isPresented = false\n                                }\n                                offset = 0\n                            }\n                    )\n                    .drawingGroup() //4\n                    .zIndex(1) //5\n                    .offset(y: offset) //6\n                    .animation(.spring, value: offset) // 7\n                    .transition(.move(edge: .bottom).combined(with: .opacity)) // 8\n            }\n        }\n        .animation(.snappy(duration: 0.3), value: isPresented) // 9\n        .ignoresSafeArea(.all, edges: .bottom)\n    }\n}\n```\n\nThere’s a lot of modifiers here, so let’s go line by line:\n1. InnerView() is the contents of our sheet. It’ll be replaced by a view builder later on\n2. The background, view with constant corner radius. Getting the corner radius of the device requires use a private API ([shh…](https://github.com/kylebshr/ScreenCorners))\n3. This is the gesture that lets the sheet dismiss when swiped down. \n4. `drawingGroup()` makes sure that the whole sheet is animated as one unit instead of letting the animations trickle down to the individual views.\n5. A `zIndex` is necessary of greater than 0 is required to make sure that the sheet stays above the overlay on the bottom layer.\n6. The offset that is controlled by the drag gesture.\n7. An animation that makes dragging the sheet feel more… buttery.\n8. A transition for when the view appears and disappears.\n9. Setting the animation curve for said transition.\n10. An overlay to darken the view behind the sheet.\n\nHere is what it looks like:\n![The above View in a sheet](/images/blog/sheet-1/sheet.png)\n\n\nAnd here it is in action:\n\u003Cvideo width=\"320\" height=\"240\" controls>\n  \u003Csource src=\"/images/blog/sheet-1/sheet_video.mp4\" type=\"video/mp4\">\n\u003C/video>\n\n\n---- \n\n# Making the View Modifier\n\nNow that we have that, we can begin trying to make this into a view modifier. This isn’t actually very hard. First, we need to define our view modifier:\n```swift\nstruct CustomSheet: ViewModifier {\n    func body(content: Content) -> some View {\n\t\t\n    }\n}\n```\n\n`content` here is the View that this modifier is applied to. In our case, that will be the `ScrollView` from before. We also need to capture the content that will go _in_ our sheet. To do so, we need to define a `@ViewBuilder`, which allows us to accept a SwiftUI View in a closure. But what will the type of this be? Since it’s a ViewBuilder, it must be a closure, but what is the result type? It must be able to accept any type that conforms to `View`, so we use a generic.\n\n```swift\nstruct CustomSheet\u003CSheetContent: View>: ViewModifier {\n\t@ViewBuilder var sheetContent: () -> SheetContent\t\n\n\tfunc body(content: Content) -> some View {\n\t\t\n    }\n}\n```\n\nFinally, we can port over all our functionality from the previous section:\n\n```swift\nstruct CustomSheet\u003CSheetContent: View>: ViewModifier {\n    @Binding var isPresented: Bool\n    @State var offset: CGFloat = 0\n    \n    @ViewBuilder var sheetContent: () -> SheetContent\n    \n    func body(content: Content) -> some View {\n        ZStack(alignment: .bottom) {\n            content\n                .overlay {\n                    Color.black.opacity(isPresented ? 0.3 : 0.0)\n                }\n            \n            if isPresented {\n                sheetContent() \n                    .background(.background.secondary, in: .rect(cornerRadius: 50))\n                    ...rest of the modifiers\n            }\n        }\n        .animation(.snappy(duration: 0.3), value: isPresented)\n        .ignoresSafeArea(.all, edges: .bottom)\n    }\n}\n```\n\nWe can also extend `View` so that our sheet modifier is easy to apply:\n\n```swift\nextension View {\n    func customSheet\u003CSheetContent>(\n        isPresented: Binding\u003CBool>,\n        @ViewBuilder sheetContent: @escaping () -> SheetContent\n    ) -> some View where SheetContent: View {\n        modifier(\n            CustomSheet(\n                isPresented: isPresented,\n                sheetContent: sheetContent\n            )\n        )\n    }\n}\n```\n\nAnd with that, our callsite now looks like this:\n\n```swift\nstruct ContentView: View {\n    @State var isPresented: Bool = true\n        \n    var body: some View {\n        ScrollView {\n            VStack {\n                Image(systemName: \"globe\")\n                    .imageScale(.large)\n                    .foregroundStyle(.tint)\n                Text(\"Hello, world!\")\n                Button(\"Present Sheet\") {\n                    isPresented = true\n                }\n            }\n            .frame(maxWidth: .infinity)\n            .padding()\n        }\n        .customSheet(isPresented: $isPresented) {\n            InnerView()\n        }\n    }\n}\n```\n\nMuch nicer! It already looks fairly similar to SwiftUI’s sheet. There are some fairly obvious issues, though:\n1. There is no `onDismiss` closure.\n2. The second initializer is unimplemented.\n3. Safe areas might be broken, since we ignore the bottom safe area on the whole ZStack.\n4. We haven’t even begun thinking about how to implement the various view modifiers that affect SwiftUI’s sheet presentation.\n\nFor now, though, this is good. We’ll tackle all these issues in Part II.\n\nAll the code for this project is on [Github](https://github.com/reftonull/ExploringSheet)\n\n[^1]: For more information on SwiftUI API design, watch the session titled [_The craft of SwiftUI API design_](https://developer.apple.com/videos/play/wwdc2022/10059/) from WWDC22","src/content/blog/building-sheet-1.md","c0fecec22a1c7298",{"html":51,"metadata":52},"\u003Cp>You’re looking at that title and probably thinking, “not another gosh darn SwiftUI bottom sheet implementation!” And to that I’d say that you’re probably right to be skeptical. However, I think this series of posts could be worth your while. This isn’t just about  \u003Ccode>.sheet\u003C/code>, it’s about SwiftUI API design. I will try to keep my final implementation as close as possible to the Apple version as possible, and try to peel back how they achieve the API they have.\u003C/p>\n\u003Chr>\n\u003Ch1 id=\"swiftui-sheet\">SwiftUI Sheet\u003C/h1>\n\u003Cp>Let’s begin with an exploration of the native \u003Ccode>.sheet\u003C/code> modifier, and see how it works.\u003C/p>\n\u003Cp>SwiftUI’s \u003Ccode>.sheet\u003C/code> modifier defined on \u003Ccode>View\u003C/code>, and has two initializers:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// 1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">.\u003C/span>\u003Cspan style=\"color:#79B8FF\">sheet\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    isPresented\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: Binding\u003C/span>\u003Cspan style=\"color:#F97583\">&#x3C;\u003C/span>\u003Cspan style=\"color:#79B8FF\">Bool\u003C/span>\u003Cspan style=\"color:#F97583\">>\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    onDismiss\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: (() \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#79B8FF\"> Void\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003Cspan style=\"color:#F97583\">?\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    content\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: () \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> View\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">) \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> View\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// 2\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">.\u003C/span>\u003Cspan style=\"color:#79B8FF\">sheet\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    item\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: Binding\u003C/span>\u003Cspan style=\"color:#F97583\">&#x3C;\u003C/span>\u003Cspan style=\"color:#E1E4E8\">Identifiable\u003C/span>\u003Cspan style=\"color:#F97583\">?>\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    onDismiss\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: (() \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#79B8FF\"> Void\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003Cspan style=\"color:#F97583\">?\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    content\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: (Identifiable) \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> View\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">) \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> View\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The first is simpler than the second. In the first initializer, sheet takes a boolean \u003Ccode>Binding\u003C/code>, which determines whether the sheet is shown or not. When the value of \u003Ccode>isPresented\u003C/code> is set to \u003Ccode>true\u003C/code>, the view built by the \u003Ccode>content\u003C/code> view builder is presented. When it is set to \u003Ccode>false\u003C/code>, the sheet is dismissed.\u003C/p>\n\u003Cp>The second initializer, instead of taking a boolean \u003Ccode>Binding\u003C/code>, takes a \u003Ccode>Binding\u003C/code> to an \u003Cem>optional\u003C/em> \u003Ccode>Identifiable\u003C/code> value. When the optional value is non-nil, the view built by the \u003Ccode>content\u003C/code> view builder is presented. The view builder takes as a parameter the non-optional version of the binding’s value. For example, if you pass a \u003Ccode>Binding&#x3C;CustomItem?>\u003C/code>for \u003Ccode>item\u003C/code>, the content view builder would take a \u003Ccode>CustomItem\u003C/code> as a parameter (\u003Ccode>(CustomItem) -> View\u003C/code> would be the signature.)\u003C/p>\n\u003Cp>Both initializers also have an optional \u003Ccode>onDismiss\u003C/code> closure that is triggered when the view is dismissed with by a system behavior, for example, a downward swipe on iOS or iPadOS. This is why we have a \u003Ccode>Binding\u003C/code> to the item value and the isPresented value: the sheet needs to be dismissible by SwiftUI. If it is dismissed, it updates \u003Ccode>isPresented\u003C/code> and \u003Ccode>item\u003C/code> accordingly.\u003C/p>\n\u003Cp>But why does \u003Ccode>.sheet\u003C/code> look like this? It’s all about progressive disclosure: the idea that common cases should have simple call sites, but there should be more power if developers need it.\u003Csup>\u003Ca href=\"#user-content-fn-1\" id=\"user-content-fnref-1\" data-footnote-ref=\"\" aria-describedby=\"footnote-label\">1\u003C/a>\u003C/sup> The first initializer is a perfect example of keeping the callsite simple. All you need is this:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">.\u003C/span>\u003Cspan style=\"color:#79B8FF\">sheet\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">isPresented\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: $isPresented) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    Text\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Hello World\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>But if you need more control, you can do this:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">.\u003C/span>\u003Cspan style=\"color:#79B8FF\">sheet\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">item\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: $item, \u003C/span>\u003Cspan style=\"color:#79B8FF\">onDismiss\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    print\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Sheet dismissed!\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}) { item \u003C/span>\u003Cspan style=\"color:#F97583\">in\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    Text\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(item.\u003C/span>\u003Cspan style=\"color:#79B8FF\">text\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>SwiftUI also embraces composability instead of enumeration. Instead of adding all of sheet’s options to the \u003Ccode>.sheet\u003C/code> modifier itself, SwiftUI opts to put them into supplementary view modifiers, like \u003Ccode>.presentationCornerRadius\u003C/code> and \u003Ccode>.presentationDetents\u003C/code>. This is what a cluttered API would look like:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">.\u003C/span>\u003Cspan style=\"color:#79B8FF\">sheet\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    item\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: $item,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    presentationCornerRadius\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#79B8FF\">50\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    presentationDetents\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: [.medium, .large],\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    onDismiss\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">        print\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Sheet dismissed!\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">) { item \u003C/span>\u003Cspan style=\"color:#F97583\">in\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    Text\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(item.\u003C/span>\u003Cspan style=\"color:#79B8FF\">text\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Instead, SwiftUI does this:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">.\u003C/span>\u003Cspan style=\"color:#79B8FF\">sheet\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    item\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: $item,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    onDismiss\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">        print\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Sheet dismissed!\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">) { item \u003C/span>\u003Cspan style=\"color:#F97583\">in\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    Text\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(item.\u003C/span>\u003Cspan style=\"color:#79B8FF\">text\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        .\u003C/span>\u003Cspan style=\"color:#79B8FF\">presentationCornerRadius\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">50\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        .\u003C/span>\u003Cspan style=\"color:#79B8FF\">presentationDetents\u003C/span>\u003Cspan style=\"color:#E1E4E8\">([.medium, .large])\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>That might not seem like much, but it quickly adds up. This also allows the SwiftUI team to add more functionality to sheets without breaking changes. Just add a new view modifier! We’ll explore this more thoroughly in future parts of this series.\u003C/p>\n\u003Cp>For now, let’s implement the simple case.\u003C/p>\n\u003Chr>\n\u003Ch1 id=\"a-rough-implementation\">A Rough Implementation\u003C/h1>\n\u003Cp>First, let us see what look we are targeting for our new sheet modifier. We’re going to try and recreate this sheet that apple uses for many of its apps, including spacial audio, and to show AirPods battery status.\u003C/p>\n\u003Cp>\u003Cimg src=\"/images/blog/sheet-1/spatial_audio.jpg\" alt=\"The sheet we&#x27;re attempting to replicate. A sheet with the title &#x22;Personalized Spatial Audio,&#x22; which has two buttons at the bottom, titled &#x22;Get Started&#x22; and &#x22;Not Now&#x22;\">\u003C/p>\n\u003Cp>First, let’s try to achieve the style with no view modifiers. Just VStacks and ZStacks.\u003C/p>\n\u003Cp>I wrote a simple View that will be my sheet’s content, trying to match the screenshot above. It’s not important to this post, but here’s \u003Ca href=\"https://github.com/reftonull/ExploringSheet/blob/main/SheetExploration/ContentView.swift\">the code\u003C/a>. This is what it looks like:\n\u003Cimg src=\"/images/blog/sheet-1/inner_view.png\" alt=\"The above sheet as a SwiftUI View\">\u003C/p>\n\u003Cp>Now we move to the actual sheet.\u003C/p>\n\u003Cp>We begin with a simple base View on top of which we’ll put our sheet:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">struct\u003C/span>\u003Cspan style=\"color:#B392F0\"> ContentView\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#B392F0\">View \u003C/span>\u003Cspan style=\"color:#E1E4E8\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    @State\u003C/span>\u003Cspan style=\"color:#F97583\"> var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> isPresented: \u003C/span>\u003Cspan style=\"color:#79B8FF\">Bool\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#79B8FF\"> false\u003C/span>\u003Cspan style=\"color:#6A737D\"> // 1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> body: \u003C/span>\u003Cspan style=\"color:#F97583\">some\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> View {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">       \tScrollView\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">            VStack\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                Image\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">systemName\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"globe\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    .\u003C/span>\u003Cspan style=\"color:#79B8FF\">imageScale\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(.large)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    .\u003C/span>\u003Cspan style=\"color:#79B8FF\">foregroundStyle\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(.tint)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                Text\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Hello, world!\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                Button\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Present Sheet\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    isPresented \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> true\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            .\u003C/span>\u003Cspan style=\"color:#79B8FF\">padding\u003C/span>\u003Cspan style=\"color:#E1E4E8\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        .\u003C/span>\u003Cspan style=\"color:#79B8FF\">frame\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">maxWidth\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .\u003C/span>\u003Cspan style=\"color:#79B8FF\">infinity\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">\t}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Col>\n\u003Cli>\u003Ccode>isPresented\u003C/code> is the binding we will eventually pass into our custom sheet modifier.\u003C/li>\n\u003C/ol>\n\u003Cp>Next, we wrap the whole thing in a ZStack and add our sheet conditionally, based on isPresented:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">struct\u003C/span>\u003Cspan style=\"color:#B392F0\"> ContentView\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#B392F0\">View \u003C/span>\u003Cspan style=\"color:#E1E4E8\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    @State\u003C/span>\u003Cspan style=\"color:#F97583\"> var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> isPresented: \u003C/span>\u003Cspan style=\"color:#79B8FF\">Bool\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#79B8FF\"> false\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    @State\u003C/span>\u003Cspan style=\"color:#F97583\"> var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> offset: CGFloat \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> body: \u003C/span>\u003Cspan style=\"color:#F97583\">some\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> View {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">        ZStack\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">alignment\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .bottom) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">            ScrollView\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                VStack\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                    Image\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">systemName\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"globe\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                        .\u003C/span>\u003Cspan style=\"color:#79B8FF\">imageScale\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(.large)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                        .\u003C/span>\u003Cspan style=\"color:#79B8FF\">foregroundStyle\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(.tint)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                    Text\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Hello, world!\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                    Button\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Present Sheet\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                        isPresented \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> true\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            \t.\u003C/span>\u003Cspan style=\"color:#79B8FF\">frame\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">maxWidth\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .\u003C/span>\u003Cspan style=\"color:#79B8FF\">infinity\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                .\u003C/span>\u003Cspan style=\"color:#79B8FF\">padding\u003C/span>\u003Cspan style=\"color:#E1E4E8\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            .\u003C/span>\u003Cspan style=\"color:#79B8FF\">overlay\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { \u003C/span>\u003Cspan style=\"color:#6A737D\">// 10\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                Color.black.\u003C/span>\u003Cspan style=\"color:#79B8FF\">opacity\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(isPresented \u003C/span>\u003Cspan style=\"color:#F97583\">?\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0.3\u003C/span>\u003Cspan style=\"color:#F97583\"> :\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0.0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">            if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> isPresented {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                InnerView\u003C/span>\u003Cspan style=\"color:#E1E4E8\">() \u003C/span>\u003Cspan style=\"color:#6A737D\">// 1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    .\u003C/span>\u003Cspan style=\"color:#79B8FF\">background\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(.background.secondary, \u003C/span>\u003Cspan style=\"color:#79B8FF\">in\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .\u003C/span>\u003Cspan style=\"color:#79B8FF\">rect\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">cornerRadius\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#79B8FF\">50\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)) \u003C/span>\u003Cspan style=\"color:#6A737D\">// 2\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    .\u003C/span>\u003Cspan style=\"color:#79B8FF\">padding\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">4\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    .\u003C/span>\u003Cspan style=\"color:#79B8FF\">gesture\u003C/span>\u003Cspan style=\"color:#E1E4E8\">( \u003C/span>\u003Cspan style=\"color:#6A737D\">// 3\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                        DragGesture\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">coordinateSpace\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .global)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                            .\u003C/span>\u003Cspan style=\"color:#79B8FF\">onChanged\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { value \u003C/span>\u003Cspan style=\"color:#F97583\">in\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                                offset \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> clip\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                                    value\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: value.translation.height,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                                    lower\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#79B8FF\">-30\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                                    upper\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .\u003C/span>\u003Cspan style=\"color:#79B8FF\">infinity\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                                )\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                            .\u003C/span>\u003Cspan style=\"color:#79B8FF\">onEnded\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { value \u003C/span>\u003Cspan style=\"color:#F97583\">in\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">                                if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> value.translation.height \u003C/span>\u003Cspan style=\"color:#F97583\">>\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 30\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                                    isPresented \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> false\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                                }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                                offset \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    )\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    .\u003C/span>\u003Cspan style=\"color:#79B8FF\">drawingGroup\u003C/span>\u003Cspan style=\"color:#E1E4E8\">() \u003C/span>\u003Cspan style=\"color:#6A737D\">//4\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    .\u003C/span>\u003Cspan style=\"color:#79B8FF\">zIndex\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) \u003C/span>\u003Cspan style=\"color:#6A737D\">//5\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    .\u003C/span>\u003Cspan style=\"color:#79B8FF\">offset\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">y\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: offset) \u003C/span>\u003Cspan style=\"color:#6A737D\">//6\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    .\u003C/span>\u003Cspan style=\"color:#79B8FF\">animation\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(.spring, \u003C/span>\u003Cspan style=\"color:#79B8FF\">value\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: offset) \u003C/span>\u003Cspan style=\"color:#6A737D\">// 7\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    .\u003C/span>\u003Cspan style=\"color:#79B8FF\">transition\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(.\u003C/span>\u003Cspan style=\"color:#79B8FF\">move\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">edge\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .bottom).\u003C/span>\u003Cspan style=\"color:#79B8FF\">combined\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">with\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .opacity)) \u003C/span>\u003Cspan style=\"color:#6A737D\">// 8\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        .\u003C/span>\u003Cspan style=\"color:#79B8FF\">animation\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(.\u003C/span>\u003Cspan style=\"color:#79B8FF\">snappy\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">duration\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#79B8FF\">0.3\u003C/span>\u003Cspan style=\"color:#E1E4E8\">), \u003C/span>\u003Cspan style=\"color:#79B8FF\">value\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: isPresented) \u003C/span>\u003Cspan style=\"color:#6A737D\">// 9\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        .\u003C/span>\u003Cspan style=\"color:#79B8FF\">ignoresSafeArea\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(.all, \u003C/span>\u003Cspan style=\"color:#79B8FF\">edges\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .bottom)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>There’s a lot of modifiers here, so let’s go line by line:\u003C/p>\n\u003Col>\n\u003Cli>InnerView() is the contents of our sheet. It’ll be replaced by a view builder later on\u003C/li>\n\u003Cli>The background, view with constant corner radius. Getting the corner radius of the device requires use a private API (\u003Ca href=\"https://github.com/kylebshr/ScreenCorners\">shh…\u003C/a>)\u003C/li>\n\u003Cli>This is the gesture that lets the sheet dismiss when swiped down.\u003C/li>\n\u003Cli>\u003Ccode>drawingGroup()\u003C/code> makes sure that the whole sheet is animated as one unit instead of letting the animations trickle down to the individual views.\u003C/li>\n\u003Cli>A \u003Ccode>zIndex\u003C/code> is necessary of greater than 0 is required to make sure that the sheet stays above the overlay on the bottom layer.\u003C/li>\n\u003Cli>The offset that is controlled by the drag gesture.\u003C/li>\n\u003Cli>An animation that makes dragging the sheet feel more… buttery.\u003C/li>\n\u003Cli>A transition for when the view appears and disappears.\u003C/li>\n\u003Cli>Setting the animation curve for said transition.\u003C/li>\n\u003Cli>An overlay to darken the view behind the sheet.\u003C/li>\n\u003C/ol>\n\u003Cp>Here is what it looks like:\n\u003Cimg src=\"/images/blog/sheet-1/sheet.png\" alt=\"The above View in a sheet\">\u003C/p>\n\u003Cp>And here it is in action:\n\u003Cvideo width=\"320\" height=\"240\" controls>\n\u003Csource src=\"/images/blog/sheet-1/sheet_video.mp4\" type=\"video/mp4\">\n\u003C/video>\u003C/p>\n\u003Chr>\n\u003Ch1 id=\"making-the-view-modifier\">Making the View Modifier\u003C/h1>\n\u003Cp>Now that we have that, we can begin trying to make this into a view modifier. This isn’t actually very hard. First, we need to define our view modifier:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">struct\u003C/span>\u003Cspan style=\"color:#B392F0\"> CustomSheet\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#B392F0\">ViewModifier \u003C/span>\u003Cspan style=\"color:#E1E4E8\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    func\u003C/span>\u003Cspan style=\"color:#B392F0\"> body\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#B392F0\">content\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: Content) \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#F97583\"> some\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> View {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">\t\t\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Ccode>content\u003C/code> here is the View that this modifier is applied to. In our case, that will be the \u003Ccode>ScrollView\u003C/code> from before. We also need to capture the content that will go \u003Cem>in\u003C/em> our sheet. To do so, we need to define a \u003Ccode>@ViewBuilder\u003C/code>, which allows us to accept a SwiftUI View in a closure. But what will the type of this be? Since it’s a ViewBuilder, it must be a closure, but what is the result type? It must be able to accept any type that conforms to \u003Ccode>View\u003C/code>, so we use a generic.\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">struct\u003C/span>\u003Cspan style=\"color:#B392F0\"> CustomSheet\u003C/span>\u003Cspan style=\"color:#E1E4E8\">&#x3C;\u003C/span>\u003Cspan style=\"color:#79B8FF\">SheetContent\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#B392F0\">View\u003C/span>\u003Cspan style=\"color:#E1E4E8\">>: \u003C/span>\u003Cspan style=\"color:#B392F0\">ViewModifier \u003C/span>\u003Cspan style=\"color:#E1E4E8\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">\t@ViewBuilder\u003C/span>\u003Cspan style=\"color:#F97583\"> var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> sheetContent: () \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> SheetContent\t\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">\tfunc\u003C/span>\u003Cspan style=\"color:#B392F0\"> body\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#B392F0\">content\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: Content) \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#F97583\"> some\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> View {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">\t\t\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Finally, we can port over all our functionality from the previous section:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">struct\u003C/span>\u003Cspan style=\"color:#B392F0\"> CustomSheet\u003C/span>\u003Cspan style=\"color:#E1E4E8\">&#x3C;\u003C/span>\u003Cspan style=\"color:#79B8FF\">SheetContent\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#B392F0\">View\u003C/span>\u003Cspan style=\"color:#E1E4E8\">>: \u003C/span>\u003Cspan style=\"color:#B392F0\">ViewModifier \u003C/span>\u003Cspan style=\"color:#E1E4E8\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    @Binding\u003C/span>\u003Cspan style=\"color:#F97583\"> var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> isPresented: \u003C/span>\u003Cspan style=\"color:#79B8FF\">Bool\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    @State\u003C/span>\u003Cspan style=\"color:#F97583\"> var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> offset: CGFloat \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    @ViewBuilder\u003C/span>\u003Cspan style=\"color:#F97583\"> var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> sheetContent: () \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> SheetContent\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    func\u003C/span>\u003Cspan style=\"color:#B392F0\"> body\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#B392F0\">content\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: Content) \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#F97583\"> some\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> View {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">        ZStack\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">alignment\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .bottom) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            content\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                .\u003C/span>\u003Cspan style=\"color:#79B8FF\">overlay\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    Color.black.\u003C/span>\u003Cspan style=\"color:#79B8FF\">opacity\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(isPresented \u003C/span>\u003Cspan style=\"color:#F97583\">?\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0.3\u003C/span>\u003Cspan style=\"color:#F97583\"> :\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0.0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">            if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> isPresented {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                sheetContent\u003C/span>\u003Cspan style=\"color:#E1E4E8\">() \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    .\u003C/span>\u003Cspan style=\"color:#79B8FF\">background\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(.background.secondary, \u003C/span>\u003Cspan style=\"color:#79B8FF\">in\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .\u003C/span>\u003Cspan style=\"color:#79B8FF\">rect\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">cornerRadius\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#79B8FF\">50\u003C/span>\u003Cspan style=\"color:#E1E4E8\">))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">                    ...\u003C/span>\u003Cspan style=\"color:#E1E4E8\">rest \u003C/span>\u003Cspan style=\"color:#F97583\">of\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> the modifiers\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        .\u003C/span>\u003Cspan style=\"color:#79B8FF\">animation\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(.\u003C/span>\u003Cspan style=\"color:#79B8FF\">snappy\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">duration\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#79B8FF\">0.3\u003C/span>\u003Cspan style=\"color:#E1E4E8\">), \u003C/span>\u003Cspan style=\"color:#79B8FF\">value\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: isPresented)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        .\u003C/span>\u003Cspan style=\"color:#79B8FF\">ignoresSafeArea\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(.all, \u003C/span>\u003Cspan style=\"color:#79B8FF\">edges\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .bottom)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>We can also extend \u003Ccode>View\u003C/code> so that our sheet modifier is easy to apply:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">extension\u003C/span>\u003Cspan style=\"color:#B392F0\"> View\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    func\u003C/span>\u003Cspan style=\"color:#B392F0\"> customSheet\u003C/span>\u003Cspan style=\"color:#E1E4E8\">&#x3C;\u003C/span>\u003Cspan style=\"color:#79B8FF\">SheetContent\u003C/span>\u003Cspan style=\"color:#E1E4E8\">>(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">        isPresented\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: Binding&#x3C;\u003C/span>\u003Cspan style=\"color:#79B8FF\">Bool\u003C/span>\u003Cspan style=\"color:#E1E4E8\">>,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        @\u003C/span>\u003Cspan style=\"color:#B392F0\">ViewBuilder\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> sheetContent: \u003C/span>\u003Cspan style=\"color:#F97583\">@escaping\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> () \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> SheetContent\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    ) \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#F97583\"> some\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> View \u003C/span>\u003Cspan style=\"color:#F97583\">where\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> SheetContent\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> View\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">        modifier\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">            CustomSheet\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                isPresented\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: isPresented,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                sheetContent\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: sheetContent\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            )\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        )\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>And with that, our callsite now looks like this:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">struct\u003C/span>\u003Cspan style=\"color:#B392F0\"> ContentView\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#B392F0\">View \u003C/span>\u003Cspan style=\"color:#E1E4E8\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    @State\u003C/span>\u003Cspan style=\"color:#F97583\"> var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> isPresented: \u003C/span>\u003Cspan style=\"color:#79B8FF\">Bool\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#79B8FF\"> true\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> body: \u003C/span>\u003Cspan style=\"color:#F97583\">some\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> View {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">        ScrollView\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">            VStack\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                Image\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">systemName\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"globe\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    .\u003C/span>\u003Cspan style=\"color:#79B8FF\">imageScale\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(.large)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    .\u003C/span>\u003Cspan style=\"color:#79B8FF\">foregroundStyle\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(.tint)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                Text\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Hello, world!\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                Button\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Present Sheet\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    isPresented \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> true\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            .\u003C/span>\u003Cspan style=\"color:#79B8FF\">frame\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">maxWidth\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .\u003C/span>\u003Cspan style=\"color:#79B8FF\">infinity\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            .\u003C/span>\u003Cspan style=\"color:#79B8FF\">padding\u003C/span>\u003Cspan style=\"color:#E1E4E8\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        .\u003C/span>\u003Cspan style=\"color:#79B8FF\">customSheet\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">isPresented\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: $isPresented) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">            InnerView\u003C/span>\u003Cspan style=\"color:#E1E4E8\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Much nicer! It already looks fairly similar to SwiftUI’s sheet. There are some fairly obvious issues, though:\u003C/p>\n\u003Col>\n\u003Cli>There is no \u003Ccode>onDismiss\u003C/code> closure.\u003C/li>\n\u003Cli>The second initializer is unimplemented.\u003C/li>\n\u003Cli>Safe areas might be broken, since we ignore the bottom safe area on the whole ZStack.\u003C/li>\n\u003Cli>We haven’t even begun thinking about how to implement the various view modifiers that affect SwiftUI’s sheet presentation.\u003C/li>\n\u003C/ol>\n\u003Cp>For now, though, this is good. We’ll tackle all these issues in Part II.\u003C/p>\n\u003Cp>All the code for this project is on \u003Ca href=\"https://github.com/reftonull/ExploringSheet\">Github\u003C/a>\u003C/p>\n\u003Csection data-footnotes=\"\" class=\"footnotes\">\u003Ch2 class=\"sr-only\" id=\"footnote-label\">Footnotes\u003C/h2>\n\u003Col>\n\u003Cli id=\"user-content-fn-1\">\n\u003Cp>For more information on SwiftUI API design, watch the session titled \u003Ca href=\"https://developer.apple.com/videos/play/wwdc2022/10059/\">\u003Cem>The craft of SwiftUI API design\u003C/em>\u003C/a> from WWDC22 \u003Ca href=\"#user-content-fnref-1\" data-footnote-backref=\"\" aria-label=\"Back to reference 1\" class=\"data-footnote-backref\">↩\u003C/a>\u003C/p>\n\u003C/li>\n\u003C/ol>\n\u003C/section>",{"headings":53,"localImagePaths":68,"remoteImagePaths":69,"frontmatter":70,"imagePaths":72},[54,58,61,64],{"depth":55,"slug":56,"text":57},1,"swiftui-sheet","SwiftUI Sheet",{"depth":55,"slug":59,"text":60},"a-rough-implementation","A Rough Implementation",{"depth":55,"slug":62,"text":63},"making-the-view-modifier","Making the View Modifier",{"depth":65,"slug":66,"text":67},2,"footnote-label","Footnotes",[],[],{"title":39,"subtitle":40,"colors":71,"publishDate":41,"pubDate":41,"draft":42},{"b1":44,"b2":45,"b3":46},[],"building-sheet-1.md","building-sheet-2",{"id":74,"data":76,"body":81,"filePath":82,"digest":83,"rendered":84,"legacyId":106},{"title":77,"subtitle":78,"description":16,"publishDate":79,"pubDate":79,"draft":42,"colors":80},"SwiftUI API Design: Sheet II","In this part, we create a new initializer for the sheet that takes an `item` instead of a `isPresented` binding. We also run into some trouble along the way, and do a deep dive on how SwiftUI works.","04/16/24",{"b1":44,"b2":45,"b3":46},"We’re back for another closer look at our implementation of a sheet modifier.\nLast time, we ended with an implementation that had the following deficiencies:\n\n1. `item` initializer is unimplemented.\n2. No dismiss behavior.\n3. Safe areas might be broken.\n4. Yet to think about how to implement view modifiers that change the behavior of the sheet.\n\nToday, we will tackle the first of those deficiencies.\n\n# Why `item`?\n\nSwiftUI’s APIs are built on the idea of progressive disclosure. The most common cases are very simple to build. Often, the first sheet initializer, the one that takes an `isPresented` Binding is all you need. However, there are times when something more involved is necessary. For example, let’s imagine we’re building a sheet that displays the properties of this struct:\n\n```swift\nstruct Item {\n\tvar id: UUID\n\tvar text: String\n}\n```\n\nLet’s look at what it would look like for us to build this using the `isPresented` initializer, and why we would even want a different initializer.\n\nA simple example View could look like this:\n\n```swift\nstruct ContentView: View {\n\t@State var isPresented: Bool = false\n\t@State var item: Item? = nil\n\n\tvar body: some View {\n        VStack {\n            Button(\"Change Item + Present Sheet\") {\n                item = Item(\n\t\t\t\t\tid: UUID(),\n\t\t\t\t\ttext: \"This is some text\"\n\t\t\t\t)\n                isPresented = true\n            }\n        }\n        .sheet(\n\t\t\tisPresented: $isPresented,\n\t\t\tonDismiss: { item = nil }\n\t\t) {\n            VStack(alignment: .leading) {\n                Text(\"isPresented: \\(isPresented)\")\n                Text(\"Text: \\(item?.text)\")\n            }\n        }\n}\n```\n\nThere are few reasons why this is not ideal.\n\nFirst, we have a domain modeling issue. There is a common adage in domain modeling: **Make illegal states unrepresentable**.[^1] The idea here is that we should take advantage of Swift’s expressive type system. It allows us to model our state in such a way that we omit whole classes of bugs.\n\nHere, we aren’t doing that. We have two properties that are inherently tied together, yet separate. This creates four states:\n\n|                    | item: nil | item: some |\n| ------------------ | --------- | ---------- |\n| isPresented: true  | invalid   | valid      |\n| isPresented: false | valid     | invalid    |\n\nOnly two of these states are valid, i.e, when isPresented and item correspond. Thus, we have to update them together.\n\nThis isn’t great. Since `item` has type `Item?`, we have all the information we need right there, without adding these invalid states. This alone calls for a more general variation of our API.\n\nHowever, there is a second problem. The code snippet simply doesn’t work!\n\n# An unexpected turn\n\nAt first glance, the code above seems perfectly reasonable. The `item` and `isPresented` bindings are updated together, and `item` is nil’d out when the sheet is dismissed. Therefore, they stay in sync.\n\nHowever, this happens on first launch:\n\n\u003Cvideo width=\"320\" height=\"240\" controls>\n  \u003Csource src=\"/images/blog/sheet-2/weird_1.mp4\" type=\"video/mp4\">\n\u003C/video>\n\nWhat’s happening here?\n\nWe update both the bindings with our button. We know that’s working, because the sheet comes up. Why is the `isPresented` value within the sheet showing false? Why does it work from then onwards?\n\nLet’s try to see if the binding updates outside the sheet by adding some text to the View:\n\n```swift\nstruct ContentView: View {\n\t@State var isPresented: Bool = false\n\t@State var item: Item? = nil\n\n\tvar body: some View {\n        VStack {\n\t\t\tText(\"isPresented: \\(isPresented)\")\n            Text(\"Text: \\(item?.text)\")\n\n            Button(\"Change Item + Present Sheet\") {\n                item = Item(\n\t\t\t\t\tid: UUID(),\n\t\t\t\t\ttext: \"This is some text\"\n\t\t\t\t)\n                isPresented = true\n            }\n        }\n        .sheet(\n\t\t\tisPresented: $isPresented,\n\t\t\tonDismiss: { item = nil }\n\t\t) {\n            VStack(alignment: .leading) {\n                Text(\"isPresented: \\(isPresented)\")\n                Text(\"Text: \\(item?.text)\")\n            }\n        }\n\t}\n}\n```\n\n\u003Cvideo width=\"320\" height=\"240\" controls>\n  \u003Csource src=\"/images/blog/sheet-2/weird_2.mp4\" type=\"video/mp4\">\n\u003C/video>\n\nWait what? The bindings are updating correctly, but that has seemingly also fixed our issue. The sheet now shows the correct data even when we first open the sheet after launch. Why did a seemingly orthogonal change to our View (adding the `Text`s) suddenly change our sheet’s output?\n\n# An unintended rabbit hole\n\nI investigated, and found some very interesting things. Here’s my best guess at what’s going on.\n\nIt all has to do with how SwiftUI handles its `@State` bindings. What does `@State` actually do?\n\nLet’s look first at why we aren’t able to mutate non-`@State` values in SwiftUI View bodies. We use this structure as an example:\n\n```swift\nstruct ExampleView: View {\n\tvar isPresented: Bool\n\n\tvar body: some View {\n\t\tButton(\"Change Item + Present Sheet\") {\n        \tisPresented = true\n\t\t//\t^~~~~~~~\n\t\t//  Cannot assign to property: 'self' is immutable\n        }\n\t}\n}\n```\n\nAs we know, `View`s in SwiftUI are modeled as value types. Further, the `body` property on `View` is a computed property. Generally, in computed property getters (which is what `body` is) we aren’t able to mutate properties.\n\nWe can try to get around this by making `body` a `mutating get`, but that doesn’t work either:\n\n```swift\nstruct ExampleView: View {\n\t//\t^~~~~~~~\n\t//  Type 'ExampleView' does not conform to protocol 'View'\n    var isPresented: Bool\n\n    var body: some View {\n        mutating get {\n            Button(\"Change Item + Present Sheet\") {\n                isPresented = true\n            }\n        }\n    }\n}\n```\n\n`View` requires body to be a non-mutating get. This makes sense. Value types for shared state is probably not a great idea, since value types are always copied. Instead, we want some reference type that stores our shared state. That’s what `@State` does. It opts the view into SwiftUI’s management of your variable, tying it to the view’s lifecycle. It stores the value in a reference type somewhere, allowing mutation.\n\nFinally, to understand what’s happening in our sheet example, we need to understand how `@State` variables interact with SwiftUI Views. `@State` wraps the type of your variable in a `State\u003CT>` wrapper. This wrapper conforms to a protocol called `DynamicProperty`. The only requirement to conform is implementing an `update()` function, which according to [Apple’s documentation](\u003Chttps://developer.apple.com/documentation/swiftui/dynamicproperty/update()-29hjo>) is called “before rendering a view’s body to ensure the view has the most recent value.”\n\nTherefore, it goes something like this: the change of an `@State` variable triggers a re-render of `body` if the variable is accessed in the body. Before the re-render, `update()` is called, to ensure we get the most recent value. `body` is computed with this updated value.\n\nNow, our example looks like this:\n\n```swift\nstruct ContentView: View {\n\t@State var isPresented: Bool = false\n\t@State var item: Item? = nil\n\n\tvar body: some View {\n        VStack {\n\t\t//  Text(\"isPresented: \\(isPresented)\")\n        //  Text(\"Text: \\(item?.text)\")\n\n            Button(\"Change Item + Present Sheet\") {\n                item = Item(\n\t\t\t\t\tid: UUID(),\n\t\t\t\t\ttext: \"This is some text\"\n\t\t\t\t)\n                isPresented = true\n            }\n        }\n        .sheet(\n\t\t\tisPresented: $isPresented,\n\t\t\tonDismiss: { item = nil }\n\t\t) {\n            VStack(alignment: .leading) {\n                Text(\"isPresented: \\(isPresented)\")\n                Text(\"Text: \\(item?.text)\")\n            }\n        }\n\t}\n}\n```\n\nWhen `isPresented` is changed in the button closure, the binding is updated, but the body isn’t recomputed because `isPresented` isn’t used in the view’s body.\n\nIt _is_ used in the sheet, but that content is not yet rendered, and thus isn’t in SwiftUI’s rendering hierarchy. The change in binding presents the `sheet`, which causes the sheet’s `content` closure to be executed. However, since this isn’t a full body recomputation, `update()` still isn’t called on the `State` variables, providing us with the stale values we see in our sheet.\n\nI suspect that this also explains why this fixes later sheet presentations: SwiftUI sees that the `@State` values are indeed used in the sheet, and recomputes the whole body when the sheet is presented.\n\nYou can try this yourself! In the above code, set a breakpoint on the body first line of the body property. You will see that the breakpoint isn’t hit the first time the bindings are changed, but is hit the subsequent times.\n\nThis is fascinating, and seems very odd indeed. Of course, this sleuthing is my best guess. SwiftUI works in a lot of magical ways, so if you have more insight, or a correction to something I’ve written about here, [let me know](https://lakshchakraborty.com/about#contact)!\n\n# Back to `item`\n\nI think the motivation for this initializer is now well established. Just as a reminder, the initializer looks like this:\n\n```swift\n.sheet(\n    item: Binding\u003CIdentifiable?>,\n    onDismiss: (() -> Void)?,\n    content: (Identifiable) -> View\n) -> View\n```\n\nIt takes a Binding to an optional `Identifiable` type and returns the non-optional version to the `content` closure.\n\nWe have a few options for how we implement this:\n\n1. Update our existing view modifier to include an initializer for a binding to an optional `Identifiable`\n2. Duplicate our code, and make a whole new view modifier.\n\nI prefer the latter approach to keep our code simple, but I’d also like to avoid duplicating all the styles. Therefore, we begin by pulling out the shared styling modifiers into its own modifier:\n\n```swift\nstruct CustomSheetInternalModifier: ViewModifier {\n    @State private var offset: CGFloat = 0\n\n    func body(content: Content) -> some View {\n        content\n            .background(.background.secondary, in: .rect(cornerRadius: 50))\n            .padding(4)\n            .gesture(\n                DragGesture(coordinateSpace: .global)\n                    .onChanged { value in\n                        offset = clip (\n                            value: value.translation.height,\n                            lower: -30,\n                            upper: .infinity\n                        )\n                    }\n                    .onEnded { value in\n                        if value.predictedEndTranslation.height > 100 {\n                            dismissAction()\n                        }\n                        offset = 0\n                    }\n            )\n            .drawingGroup()\n            .zIndex(1)\n            .offset(y: offset)\n            .animation(.spring, value: offset)\n            .transition(.move(edge: .bottom))\n    }\n}\n```\n\nNow, we can simplify our `isPresented` version to this:\n\n```swift\nstruct CustomSheet\u003CSheetContent: View>: ViewModifier {\n    @Binding var isPresented: Bool\n    @ViewBuilder var sheetContent: () -> SheetContent\n\n    func body(content: Content) -> some View {\n        ZStack(alignment: .bottom) {\n            content\n                .overlay {\n                    Color.black.opacity(isPresented ? 0.3 : 0.0)\n                }\n\n            if isPresented {\n                sheetContent()\n                    .modifier(CustomSheetInternalModifier())\n            }\n        }\n        .animation(.snappy(duration: 0.3), value: isPresented)\n        .ignoresSafeArea(.all, edges: .bottom)\n    }\n}\n```\n\nWe now have a better place to begin the new implementation. The good news is that there are very few changes necessary to make this work with an `item` binding instead.\n\n```swift\nstruct CustomItemSheet\u003CItem: Identifiable, SheetContent: View>: ViewModifier { // 1\n\t@Binding var item: Item? //2\n    @ViewBuilder var sheetContent: (Item) -> SheetContent // 3\n\n\tfunc body(content: Content) -> some View {\n        ZStack(alignment: .bottom) {\n            content\n                .overlay {\n                    Color.black.opacity(isPresented ? 0.3 : 0.0)\n                }\n\n            if let item { // 4\n                sheetContent(item) // 5\n                    .modifier(CustomSheetInternalModifier())\n            }\n        }\n        .animation(.snappy(duration: 0.3), value: item != nil) // 6\n        .ignoresSafeArea(.all, edges: .bottom)\n    }\n}\n```\n\nHere are the changes:\n\n1. We add a new generic type that conforms to `Identifiable` to the signature.\n2. The `isPresented` becomes an optional `Item`\n3. The content closure now takes a _non-optional_ `Item` as an argument. This means that `Item` is unwrapped for you, no `if-let` necessary!\n4. Unwrap `item`, and only show content if it is non-nil.\n5. Pass item to the sheet content closure.\n6. The value that the animation will fire for is now `item != nil`, which will make sure to not animate when `item` changes to a new non-nil value. This avoids accidental animations firing.\n\nNow all we have to do is make a new extension on View:\n\n```swift\nfunc customSheet\u003CItem, SheetContent>(\n        item: Binding\u003CItem?>,\n        onDismiss: (() -> Void)? = nil,\n        @ViewBuilder sheetContent: @escaping (Item) -> SheetContent\n    ) -> some View where Item: Identifiable, SheetContent: View {\n        modifier(\n            CustomItemSheet(\n                item: item,\n                onDismiss: onDismiss,\n                sheetContent: sheetContent\n            )\n        )\n    }\n\n```\n\nThis is exactly what our previews extension looked like, except with an additional `Item` generic type.\n\nFinally, we have a sheet that works just like the SwiftUI version!\n\n```swift\nstruct ContentView: View {\n    @State var item: Item? = nil\n\n    var body: some View {\n        VStack {\n            Button(\"Change Item + Present Sheet\") {\n                item = Item(\n                    id: UUID(),\n                    text: \"This is some text\"\n                )\n            }\n        }\n        .customSheet(item: $item) { item in\n            VStack(alignment: .leading) {\n                Text(\"Text: \\(item.text)\")\n            }\n        }\n    }\n}\n```\n\nNext time, we’ll add dismiss behaviors, including an `onDismiss` closure, and some values in the environment that help with sheet dismissal! Stay tuned!\n\nAs always, the code for this project is on [Github](https://github.com/reftonull/ExploringSheet). It might be a little ahead even 👀\n\n[^1]: There are many variations on this phrase, but this version was coined by [Yaron Minsky](https://twitter.com/yminsky/status/1034947939364425731) in the context of OCaml for a series of [guest lectures](https://blog.janestreet.com/effective-ml-video/) at Harvard and Northwestern.","src/content/blog/building-sheet-2.md","68b9f9e7ce2d6546",{"html":85,"metadata":86},"\u003Cp>We’re back for another closer look at our implementation of a sheet modifier.\nLast time, we ended with an implementation that had the following deficiencies:\u003C/p>\n\u003Col>\n\u003Cli>\u003Ccode>item\u003C/code> initializer is unimplemented.\u003C/li>\n\u003Cli>No dismiss behavior.\u003C/li>\n\u003Cli>Safe areas might be broken.\u003C/li>\n\u003Cli>Yet to think about how to implement view modifiers that change the behavior of the sheet.\u003C/li>\n\u003C/ol>\n\u003Cp>Today, we will tackle the first of those deficiencies.\u003C/p>\n\u003Ch1 id=\"why-item\">Why \u003Ccode>item\u003C/code>?\u003C/h1>\n\u003Cp>SwiftUI’s APIs are built on the idea of progressive disclosure. The most common cases are very simple to build. Often, the first sheet initializer, the one that takes an \u003Ccode>isPresented\u003C/code> Binding is all you need. However, there are times when something more involved is necessary. For example, let’s imagine we’re building a sheet that displays the properties of this struct:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">struct\u003C/span>\u003Cspan style=\"color:#B392F0\"> Item\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">\tvar\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> id: UUID\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">\tvar\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> text: \u003C/span>\u003Cspan style=\"color:#79B8FF\">String\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Let’s look at what it would look like for us to build this using the \u003Ccode>isPresented\u003C/code> initializer, and why we would even want a different initializer.\u003C/p>\n\u003Cp>A simple example View could look like this:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">struct\u003C/span>\u003Cspan style=\"color:#B392F0\"> ContentView\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#B392F0\">View \u003C/span>\u003Cspan style=\"color:#E1E4E8\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">\t@State\u003C/span>\u003Cspan style=\"color:#F97583\"> var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> isPresented: \u003C/span>\u003Cspan style=\"color:#79B8FF\">Bool\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#79B8FF\"> false\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">\t@State\u003C/span>\u003Cspan style=\"color:#F97583\"> var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> item: Item\u003C/span>\u003Cspan style=\"color:#F97583\">?\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#79B8FF\"> nil\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">\tvar\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> body: \u003C/span>\u003Cspan style=\"color:#F97583\">some\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> View {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">        VStack\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">            Button\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Change Item + Present Sheet\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                item \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> Item\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">\t\t\t\t\tid\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#79B8FF\">UUID\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">\t\t\t\t\ttext\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"This is some text\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">\t\t\t\t)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                isPresented \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> true\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        .\u003C/span>\u003Cspan style=\"color:#79B8FF\">sheet\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">\t\t\tisPresented\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: $isPresented,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">\t\t\tonDismiss\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: { item \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> nil\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">\t\t) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">            VStack\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">alignment\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .leading) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                Text\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"isPresented: \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\\(isPresented)\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                Text\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Text: \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\\(item\u003C/span>\u003Cspan style=\"color:#F97583\">?\u003C/span>\u003Cspan style=\"color:#9ECBFF\">.\u003C/span>\u003Cspan style=\"color:#79B8FF\">text\u003C/span>\u003Cspan style=\"color:#9ECBFF\">)\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>There are few reasons why this is not ideal.\u003C/p>\n\u003Cp>First, we have a domain modeling issue. There is a common adage in domain modeling: \u003Cstrong>Make illegal states unrepresentable\u003C/strong>.\u003Csup>\u003Ca href=\"#user-content-fn-1\" id=\"user-content-fnref-1\" data-footnote-ref=\"\" aria-describedby=\"footnote-label\">1\u003C/a>\u003C/sup> The idea here is that we should take advantage of Swift’s expressive type system. It allows us to model our state in such a way that we omit whole classes of bugs.\u003C/p>\n\u003Cp>Here, we aren’t doing that. We have two properties that are inherently tied together, yet separate. This creates four states:\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>\u003C/th>\u003Cth>item: nil\u003C/th>\u003Cth>item: some\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>isPresented: true\u003C/td>\u003Ctd>invalid\u003C/td>\u003Ctd>valid\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>isPresented: false\u003C/td>\u003Ctd>valid\u003C/td>\u003Ctd>invalid\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cp>Only two of these states are valid, i.e, when isPresented and item correspond. Thus, we have to update them together.\u003C/p>\n\u003Cp>This isn’t great. Since \u003Ccode>item\u003C/code> has type \u003Ccode>Item?\u003C/code>, we have all the information we need right there, without adding these invalid states. This alone calls for a more general variation of our API.\u003C/p>\n\u003Cp>However, there is a second problem. The code snippet simply doesn’t work!\u003C/p>\n\u003Ch1 id=\"an-unexpected-turn\">An unexpected turn\u003C/h1>\n\u003Cp>At first glance, the code above seems perfectly reasonable. The \u003Ccode>item\u003C/code> and \u003Ccode>isPresented\u003C/code> bindings are updated together, and \u003Ccode>item\u003C/code> is nil’d out when the sheet is dismissed. Therefore, they stay in sync.\u003C/p>\n\u003Cp>However, this happens on first launch:\u003C/p>\n\u003Cvideo width=\"320\" height=\"240\" controls>\n  \u003Csource src=\"/images/blog/sheet-2/weird_1.mp4\" type=\"video/mp4\">\n\u003C/video>\n\u003Cp>What’s happening here?\u003C/p>\n\u003Cp>We update both the bindings with our button. We know that’s working, because the sheet comes up. Why is the \u003Ccode>isPresented\u003C/code> value within the sheet showing false? Why does it work from then onwards?\u003C/p>\n\u003Cp>Let’s try to see if the binding updates outside the sheet by adding some text to the View:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">struct\u003C/span>\u003Cspan style=\"color:#B392F0\"> ContentView\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#B392F0\">View \u003C/span>\u003Cspan style=\"color:#E1E4E8\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">\t@State\u003C/span>\u003Cspan style=\"color:#F97583\"> var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> isPresented: \u003C/span>\u003Cspan style=\"color:#79B8FF\">Bool\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#79B8FF\"> false\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">\t@State\u003C/span>\u003Cspan style=\"color:#F97583\"> var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> item: Item\u003C/span>\u003Cspan style=\"color:#F97583\">?\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#79B8FF\"> nil\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">\tvar\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> body: \u003C/span>\u003Cspan style=\"color:#F97583\">some\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> View {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">        VStack\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">\t\t\tText\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"isPresented: \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\\(isPresented)\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">            Text\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Text: \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\\(item\u003C/span>\u003Cspan style=\"color:#F97583\">?\u003C/span>\u003Cspan style=\"color:#9ECBFF\">.\u003C/span>\u003Cspan style=\"color:#79B8FF\">text\u003C/span>\u003Cspan style=\"color:#9ECBFF\">)\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">            Button\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Change Item + Present Sheet\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                item \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> Item\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">\t\t\t\t\tid\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#79B8FF\">UUID\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">\t\t\t\t\ttext\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"This is some text\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">\t\t\t\t)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                isPresented \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> true\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        .\u003C/span>\u003Cspan style=\"color:#79B8FF\">sheet\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">\t\t\tisPresented\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: $isPresented,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">\t\t\tonDismiss\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: { item \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> nil\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">\t\t) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">            VStack\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">alignment\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .leading) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                Text\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"isPresented: \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\\(isPresented)\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                Text\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Text: \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\\(item\u003C/span>\u003Cspan style=\"color:#F97583\">?\u003C/span>\u003Cspan style=\"color:#9ECBFF\">.\u003C/span>\u003Cspan style=\"color:#79B8FF\">text\u003C/span>\u003Cspan style=\"color:#9ECBFF\">)\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">\t}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cvideo width=\"320\" height=\"240\" controls>\n  \u003Csource src=\"/images/blog/sheet-2/weird_2.mp4\" type=\"video/mp4\">\n\u003C/video>\n\u003Cp>Wait what? The bindings are updating correctly, but that has seemingly also fixed our issue. The sheet now shows the correct data even when we first open the sheet after launch. Why did a seemingly orthogonal change to our View (adding the \u003Ccode>Text\u003C/code>s) suddenly change our sheet’s output?\u003C/p>\n\u003Ch1 id=\"an-unintended-rabbit-hole\">An unintended rabbit hole\u003C/h1>\n\u003Cp>I investigated, and found some very interesting things. Here’s my best guess at what’s going on.\u003C/p>\n\u003Cp>It all has to do with how SwiftUI handles its \u003Ccode>@State\u003C/code> bindings. What does \u003Ccode>@State\u003C/code> actually do?\u003C/p>\n\u003Cp>Let’s look first at why we aren’t able to mutate non-\u003Ccode>@State\u003C/code> values in SwiftUI View bodies. We use this structure as an example:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">struct\u003C/span>\u003Cspan style=\"color:#B392F0\"> ExampleView\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#B392F0\">View \u003C/span>\u003Cspan style=\"color:#E1E4E8\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">\tvar\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> isPresented: \u003C/span>\u003Cspan style=\"color:#79B8FF\">Bool\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">\tvar\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> body: \u003C/span>\u003Cspan style=\"color:#F97583\">some\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> View {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">\t\tButton\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Change Item + Present Sheet\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        \tisPresented \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> true\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">\t\t//\t^~~~~~~~\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">\t\t//  Cannot assign to property: 'self' is immutable\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">\t}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>As we know, \u003Ccode>View\u003C/code>s in SwiftUI are modeled as value types. Further, the \u003Ccode>body\u003C/code> property on \u003Ccode>View\u003C/code> is a computed property. Generally, in computed property getters (which is what \u003Ccode>body\u003C/code> is) we aren’t able to mutate properties.\u003C/p>\n\u003Cp>We can try to get around this by making \u003Ccode>body\u003C/code> a \u003Ccode>mutating get\u003C/code>, but that doesn’t work either:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">struct\u003C/span>\u003Cspan style=\"color:#B392F0\"> ExampleView\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#B392F0\">View \u003C/span>\u003Cspan style=\"color:#E1E4E8\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">\t//\t^~~~~~~~\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">\t//  Type 'ExampleView' does not conform to protocol 'View'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> isPresented: \u003C/span>\u003Cspan style=\"color:#79B8FF\">Bool\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> body: \u003C/span>\u003Cspan style=\"color:#F97583\">some\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> View {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">        mutating\u003C/span>\u003Cspan style=\"color:#F97583\"> get\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">            Button\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Change Item + Present Sheet\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                isPresented \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> true\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Ccode>View\u003C/code> requires body to be a non-mutating get. This makes sense. Value types for shared state is probably not a great idea, since value types are always copied. Instead, we want some reference type that stores our shared state. That’s what \u003Ccode>@State\u003C/code> does. It opts the view into SwiftUI’s management of your variable, tying it to the view’s lifecycle. It stores the value in a reference type somewhere, allowing mutation.\u003C/p>\n\u003Cp>Finally, to understand what’s happening in our sheet example, we need to understand how \u003Ccode>@State\u003C/code> variables interact with SwiftUI Views. \u003Ccode>@State\u003C/code> wraps the type of your variable in a \u003Ccode>State&#x3C;T>\u003C/code> wrapper. This wrapper conforms to a protocol called \u003Ccode>DynamicProperty\u003C/code>. The only requirement to conform is implementing an \u003Ccode>update()\u003C/code> function, which according to \u003Ca href=\"https://developer.apple.com/documentation/swiftui/dynamicproperty/update()-29hjo\">Apple’s documentation\u003C/a> is called “before rendering a view’s body to ensure the view has the most recent value.”\u003C/p>\n\u003Cp>Therefore, it goes something like this: the change of an \u003Ccode>@State\u003C/code> variable triggers a re-render of \u003Ccode>body\u003C/code> if the variable is accessed in the body. Before the re-render, \u003Ccode>update()\u003C/code> is called, to ensure we get the most recent value. \u003Ccode>body\u003C/code> is computed with this updated value.\u003C/p>\n\u003Cp>Now, our example looks like this:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">struct\u003C/span>\u003Cspan style=\"color:#B392F0\"> ContentView\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#B392F0\">View \u003C/span>\u003Cspan style=\"color:#E1E4E8\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">\t@State\u003C/span>\u003Cspan style=\"color:#F97583\"> var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> isPresented: \u003C/span>\u003Cspan style=\"color:#79B8FF\">Bool\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#79B8FF\"> false\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">\t@State\u003C/span>\u003Cspan style=\"color:#F97583\"> var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> item: Item\u003C/span>\u003Cspan style=\"color:#F97583\">?\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#79B8FF\"> nil\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">\tvar\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> body: \u003C/span>\u003Cspan style=\"color:#F97583\">some\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> View {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">        VStack\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">\t\t//  Text(\"isPresented: \\(isPresented)\")\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">        //  Text(\"Text: \\(item?.text)\")\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">            Button\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Change Item + Present Sheet\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                item \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> Item\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">\t\t\t\t\tid\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#79B8FF\">UUID\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">\t\t\t\t\ttext\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"This is some text\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">\t\t\t\t)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                isPresented \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> true\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        .\u003C/span>\u003Cspan style=\"color:#79B8FF\">sheet\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">\t\t\tisPresented\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: $isPresented,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">\t\t\tonDismiss\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: { item \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> nil\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">\t\t) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">            VStack\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">alignment\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .leading) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                Text\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"isPresented: \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\\(isPresented)\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                Text\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Text: \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\\(item\u003C/span>\u003Cspan style=\"color:#F97583\">?\u003C/span>\u003Cspan style=\"color:#9ECBFF\">.\u003C/span>\u003Cspan style=\"color:#79B8FF\">text\u003C/span>\u003Cspan style=\"color:#9ECBFF\">)\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">\t}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>When \u003Ccode>isPresented\u003C/code> is changed in the button closure, the binding is updated, but the body isn’t recomputed because \u003Ccode>isPresented\u003C/code> isn’t used in the view’s body.\u003C/p>\n\u003Cp>It \u003Cem>is\u003C/em> used in the sheet, but that content is not yet rendered, and thus isn’t in SwiftUI’s rendering hierarchy. The change in binding presents the \u003Ccode>sheet\u003C/code>, which causes the sheet’s \u003Ccode>content\u003C/code> closure to be executed. However, since this isn’t a full body recomputation, \u003Ccode>update()\u003C/code> still isn’t called on the \u003Ccode>State\u003C/code> variables, providing us with the stale values we see in our sheet.\u003C/p>\n\u003Cp>I suspect that this also explains why this fixes later sheet presentations: SwiftUI sees that the \u003Ccode>@State\u003C/code> values are indeed used in the sheet, and recomputes the whole body when the sheet is presented.\u003C/p>\n\u003Cp>You can try this yourself! In the above code, set a breakpoint on the body first line of the body property. You will see that the breakpoint isn’t hit the first time the bindings are changed, but is hit the subsequent times.\u003C/p>\n\u003Cp>This is fascinating, and seems very odd indeed. Of course, this sleuthing is my best guess. SwiftUI works in a lot of magical ways, so if you have more insight, or a correction to something I’ve written about here, \u003Ca href=\"https://lakshchakraborty.com/about#contact\">let me know\u003C/a>!\u003C/p>\n\u003Ch1 id=\"back-to-item\">Back to \u003Ccode>item\u003C/code>\u003C/h1>\n\u003Cp>I think the motivation for this initializer is now well established. Just as a reminder, the initializer looks like this:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">.\u003C/span>\u003Cspan style=\"color:#79B8FF\">sheet\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    item\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: Binding\u003C/span>\u003Cspan style=\"color:#F97583\">&#x3C;\u003C/span>\u003Cspan style=\"color:#E1E4E8\">Identifiable\u003C/span>\u003Cspan style=\"color:#F97583\">?>\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    onDismiss\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: (() \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#79B8FF\"> Void\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003Cspan style=\"color:#F97583\">?\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    content\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: (Identifiable) \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> View\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">) \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> View\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>It takes a Binding to an optional \u003Ccode>Identifiable\u003C/code> type and returns the non-optional version to the \u003Ccode>content\u003C/code> closure.\u003C/p>\n\u003Cp>We have a few options for how we implement this:\u003C/p>\n\u003Col>\n\u003Cli>Update our existing view modifier to include an initializer for a binding to an optional \u003Ccode>Identifiable\u003C/code>\u003C/li>\n\u003Cli>Duplicate our code, and make a whole new view modifier.\u003C/li>\n\u003C/ol>\n\u003Cp>I prefer the latter approach to keep our code simple, but I’d also like to avoid duplicating all the styles. Therefore, we begin by pulling out the shared styling modifiers into its own modifier:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">struct\u003C/span>\u003Cspan style=\"color:#B392F0\"> CustomSheetInternalModifier\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#B392F0\">ViewModifier \u003C/span>\u003Cspan style=\"color:#E1E4E8\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    @State\u003C/span>\u003Cspan style=\"color:#F97583\"> private\u003C/span>\u003Cspan style=\"color:#F97583\"> var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> offset: CGFloat \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    func\u003C/span>\u003Cspan style=\"color:#B392F0\"> body\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#B392F0\">content\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: Content) \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#F97583\"> some\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> View {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        content\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            .\u003C/span>\u003Cspan style=\"color:#79B8FF\">background\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(.background.secondary, \u003C/span>\u003Cspan style=\"color:#79B8FF\">in\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .\u003C/span>\u003Cspan style=\"color:#79B8FF\">rect\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">cornerRadius\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#79B8FF\">50\u003C/span>\u003Cspan style=\"color:#E1E4E8\">))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            .\u003C/span>\u003Cspan style=\"color:#79B8FF\">padding\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">4\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            .\u003C/span>\u003Cspan style=\"color:#79B8FF\">gesture\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                DragGesture\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">coordinateSpace\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .global)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    .\u003C/span>\u003Cspan style=\"color:#79B8FF\">onChanged\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { value \u003C/span>\u003Cspan style=\"color:#F97583\">in\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                        offset \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> clip\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                            value\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: value.translation.height,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                            lower\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#79B8FF\">-30\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                            upper\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .\u003C/span>\u003Cspan style=\"color:#79B8FF\">infinity\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                        )\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    .\u003C/span>\u003Cspan style=\"color:#79B8FF\">onEnded\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { value \u003C/span>\u003Cspan style=\"color:#F97583\">in\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">                        if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> value.predictedEndTranslation.height \u003C/span>\u003Cspan style=\"color:#F97583\">>\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 100\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                            dismissAction\u003C/span>\u003Cspan style=\"color:#E1E4E8\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                        offset \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            )\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            .\u003C/span>\u003Cspan style=\"color:#79B8FF\">drawingGroup\u003C/span>\u003Cspan style=\"color:#E1E4E8\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            .\u003C/span>\u003Cspan style=\"color:#79B8FF\">zIndex\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            .\u003C/span>\u003Cspan style=\"color:#79B8FF\">offset\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">y\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: offset)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            .\u003C/span>\u003Cspan style=\"color:#79B8FF\">animation\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(.spring, \u003C/span>\u003Cspan style=\"color:#79B8FF\">value\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: offset)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            .\u003C/span>\u003Cspan style=\"color:#79B8FF\">transition\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(.\u003C/span>\u003Cspan style=\"color:#79B8FF\">move\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">edge\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .bottom))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Now, we can simplify our \u003Ccode>isPresented\u003C/code> version to this:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">struct\u003C/span>\u003Cspan style=\"color:#B392F0\"> CustomSheet\u003C/span>\u003Cspan style=\"color:#E1E4E8\">&#x3C;\u003C/span>\u003Cspan style=\"color:#79B8FF\">SheetContent\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#B392F0\">View\u003C/span>\u003Cspan style=\"color:#E1E4E8\">>: \u003C/span>\u003Cspan style=\"color:#B392F0\">ViewModifier \u003C/span>\u003Cspan style=\"color:#E1E4E8\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    @Binding\u003C/span>\u003Cspan style=\"color:#F97583\"> var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> isPresented: \u003C/span>\u003Cspan style=\"color:#79B8FF\">Bool\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    @ViewBuilder\u003C/span>\u003Cspan style=\"color:#F97583\"> var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> sheetContent: () \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> SheetContent\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    func\u003C/span>\u003Cspan style=\"color:#B392F0\"> body\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#B392F0\">content\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: Content) \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#F97583\"> some\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> View {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">        ZStack\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">alignment\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .bottom) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            content\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                .\u003C/span>\u003Cspan style=\"color:#79B8FF\">overlay\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    Color.black.\u003C/span>\u003Cspan style=\"color:#79B8FF\">opacity\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(isPresented \u003C/span>\u003Cspan style=\"color:#F97583\">?\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0.3\u003C/span>\u003Cspan style=\"color:#F97583\"> :\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0.0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">            if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> isPresented {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                sheetContent\u003C/span>\u003Cspan style=\"color:#E1E4E8\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    .\u003C/span>\u003Cspan style=\"color:#79B8FF\">modifier\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">CustomSheetInternalModifier\u003C/span>\u003Cspan style=\"color:#E1E4E8\">())\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        .\u003C/span>\u003Cspan style=\"color:#79B8FF\">animation\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(.\u003C/span>\u003Cspan style=\"color:#79B8FF\">snappy\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">duration\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#79B8FF\">0.3\u003C/span>\u003Cspan style=\"color:#E1E4E8\">), \u003C/span>\u003Cspan style=\"color:#79B8FF\">value\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: isPresented)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        .\u003C/span>\u003Cspan style=\"color:#79B8FF\">ignoresSafeArea\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(.all, \u003C/span>\u003Cspan style=\"color:#79B8FF\">edges\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .bottom)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>We now have a better place to begin the new implementation. The good news is that there are very few changes necessary to make this work with an \u003Ccode>item\u003C/code> binding instead.\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">struct\u003C/span>\u003Cspan style=\"color:#B392F0\"> CustomItemSheet\u003C/span>\u003Cspan style=\"color:#E1E4E8\">&#x3C;\u003C/span>\u003Cspan style=\"color:#79B8FF\">Item\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#B392F0\">Identifiable\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#79B8FF\">SheetContent\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#B392F0\">View\u003C/span>\u003Cspan style=\"color:#E1E4E8\">>: \u003C/span>\u003Cspan style=\"color:#B392F0\">ViewModifier \u003C/span>\u003Cspan style=\"color:#E1E4E8\">{ \u003C/span>\u003Cspan style=\"color:#6A737D\">// 1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">\t@Binding\u003C/span>\u003Cspan style=\"color:#F97583\"> var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> item: Item\u003C/span>\u003Cspan style=\"color:#F97583\">?\u003C/span>\u003Cspan style=\"color:#6A737D\"> //2\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    @ViewBuilder\u003C/span>\u003Cspan style=\"color:#F97583\"> var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> sheetContent: (Item) \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> SheetContent \u003C/span>\u003Cspan style=\"color:#6A737D\">// 3\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">\tfunc\u003C/span>\u003Cspan style=\"color:#B392F0\"> body\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#B392F0\">content\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: Content) \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#F97583\"> some\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> View {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">        ZStack\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">alignment\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .bottom) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            content\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                .\u003C/span>\u003Cspan style=\"color:#79B8FF\">overlay\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    Color.black.\u003C/span>\u003Cspan style=\"color:#79B8FF\">opacity\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(isPresented \u003C/span>\u003Cspan style=\"color:#F97583\">?\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0.3\u003C/span>\u003Cspan style=\"color:#F97583\"> :\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0.0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">            if\u003C/span>\u003Cspan style=\"color:#F97583\"> let\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> item { \u003C/span>\u003Cspan style=\"color:#6A737D\">// 4\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                sheetContent\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(item) \u003C/span>\u003Cspan style=\"color:#6A737D\">// 5\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                    .\u003C/span>\u003Cspan style=\"color:#79B8FF\">modifier\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">CustomSheetInternalModifier\u003C/span>\u003Cspan style=\"color:#E1E4E8\">())\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        .\u003C/span>\u003Cspan style=\"color:#79B8FF\">animation\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(.\u003C/span>\u003Cspan style=\"color:#79B8FF\">snappy\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">duration\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#79B8FF\">0.3\u003C/span>\u003Cspan style=\"color:#E1E4E8\">), \u003C/span>\u003Cspan style=\"color:#79B8FF\">value\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: item \u003C/span>\u003Cspan style=\"color:#F97583\">!=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> nil\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) \u003C/span>\u003Cspan style=\"color:#6A737D\">// 6\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        .\u003C/span>\u003Cspan style=\"color:#79B8FF\">ignoresSafeArea\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(.all, \u003C/span>\u003Cspan style=\"color:#79B8FF\">edges\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .bottom)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Here are the changes:\u003C/p>\n\u003Col>\n\u003Cli>We add a new generic type that conforms to \u003Ccode>Identifiable\u003C/code> to the signature.\u003C/li>\n\u003Cli>The \u003Ccode>isPresented\u003C/code> becomes an optional \u003Ccode>Item\u003C/code>\u003C/li>\n\u003Cli>The content closure now takes a \u003Cem>non-optional\u003C/em> \u003Ccode>Item\u003C/code> as an argument. This means that \u003Ccode>Item\u003C/code> is unwrapped for you, no \u003Ccode>if-let\u003C/code> necessary!\u003C/li>\n\u003Cli>Unwrap \u003Ccode>item\u003C/code>, and only show content if it is non-nil.\u003C/li>\n\u003Cli>Pass item to the sheet content closure.\u003C/li>\n\u003Cli>The value that the animation will fire for is now \u003Ccode>item != nil\u003C/code>, which will make sure to not animate when \u003Ccode>item\u003C/code> changes to a new non-nil value. This avoids accidental animations firing.\u003C/li>\n\u003C/ol>\n\u003Cp>Now all we have to do is make a new extension on View:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">func\u003C/span>\u003Cspan style=\"color:#B392F0\"> customSheet\u003C/span>\u003Cspan style=\"color:#E1E4E8\">&#x3C;\u003C/span>\u003Cspan style=\"color:#79B8FF\">Item\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#79B8FF\">SheetContent\u003C/span>\u003Cspan style=\"color:#E1E4E8\">>(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">        item\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: Binding&#x3C;Item\u003C/span>\u003Cspan style=\"color:#F97583\">?\u003C/span>\u003Cspan style=\"color:#E1E4E8\">>,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">        onDismiss\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: (() \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#79B8FF\"> Void\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003Cspan style=\"color:#F97583\">?\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#79B8FF\"> nil\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        @\u003C/span>\u003Cspan style=\"color:#B392F0\">ViewBuilder\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> sheetContent: \u003C/span>\u003Cspan style=\"color:#F97583\">@escaping\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (Item) \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> SheetContent\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    ) \u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#F97583\"> some\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> View \u003C/span>\u003Cspan style=\"color:#F97583\">where\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> Item\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> Identifiable\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, SheetContent\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> View\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">        modifier\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">            CustomItemSheet\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                item\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: item,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                onDismiss\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: onDismiss,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                sheetContent\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: sheetContent\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            )\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        )\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>This is exactly what our previews extension looked like, except with an additional \u003Ccode>Item\u003C/code> generic type.\u003C/p>\n\u003Cp>Finally, we have a sheet that works just like the SwiftUI version!\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"swift\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">struct\u003C/span>\u003Cspan style=\"color:#B392F0\"> ContentView\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#B392F0\">View \u003C/span>\u003Cspan style=\"color:#E1E4E8\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    @State\u003C/span>\u003Cspan style=\"color:#F97583\"> var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> item: Item\u003C/span>\u003Cspan style=\"color:#F97583\">?\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#79B8FF\"> nil\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    var\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> body: \u003C/span>\u003Cspan style=\"color:#F97583\">some\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> View {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">        VStack\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">            Button\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Change Item + Present Sheet\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                item \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> Item\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                    id\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#79B8FF\">UUID\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                    text\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"This is some text\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">                )\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        .\u003C/span>\u003Cspan style=\"color:#79B8FF\">customSheet\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">item\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: $item) { item \u003C/span>\u003Cspan style=\"color:#F97583\">in\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">            VStack\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#79B8FF\">alignment\u003C/span>\u003Cspan style=\"color:#E1E4E8\">: .leading) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">                Text\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"Text: \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\\(item.\u003C/span>\u003Cspan style=\"color:#79B8FF\">text\u003C/span>\u003Cspan style=\"color:#9ECBFF\">)\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">            }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">        }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Next time, we’ll add dismiss behaviors, including an \u003Ccode>onDismiss\u003C/code> closure, and some values in the environment that help with sheet dismissal! Stay tuned!\u003C/p>\n\u003Cp>As always, the code for this project is on \u003Ca href=\"https://github.com/reftonull/ExploringSheet\">Github\u003C/a>. It might be a little ahead even 👀\u003C/p>\n\u003Csection data-footnotes=\"\" class=\"footnotes\">\u003Ch2 class=\"sr-only\" id=\"footnote-label\">Footnotes\u003C/h2>\n\u003Col>\n\u003Cli id=\"user-content-fn-1\">\n\u003Cp>There are many variations on this phrase, but this version was coined by \u003Ca href=\"https://twitter.com/yminsky/status/1034947939364425731\">Yaron Minsky\u003C/a> in the context of OCaml for a series of \u003Ca href=\"https://blog.janestreet.com/effective-ml-video/\">guest lectures\u003C/a> at Harvard and Northwestern. \u003Ca href=\"#user-content-fnref-1\" data-footnote-backref=\"\" aria-label=\"Back to reference 1\" class=\"data-footnote-backref\">↩\u003C/a>\u003C/p>\n\u003C/li>\n\u003C/ol>\n\u003C/section>",{"headings":87,"localImagePaths":101,"remoteImagePaths":102,"frontmatter":103,"imagePaths":105},[88,91,94,97,100],{"depth":55,"slug":89,"text":90},"why-item","Why item?",{"depth":55,"slug":92,"text":93},"an-unexpected-turn","An unexpected turn",{"depth":55,"slug":95,"text":96},"an-unintended-rabbit-hole","An unintended rabbit hole",{"depth":55,"slug":98,"text":99},"back-to-item","Back to item",{"depth":65,"slug":66,"text":67},[],[],{"title":77,"subtitle":78,"colors":104,"publishDate":79,"pubDate":79,"draft":42},{"b1":44,"b2":45,"b3":46},[],"building-sheet-2.md","projects",["Map",109,110,127,128,145,146],"perspectives",{"id":109,"data":111,"body":123,"filePath":124,"digest":125,"legacyId":126,"deferredRender":18},{"title":112,"description":113,"image":114,"appstore":115,"objective":116,"stack":117,"year":118,"timeline":119,"languages":120,"draft":42,"colors":121},"Perspectives: To-Do List","Perspectives is an app for iOS, iPadOS, and visionOS designed to get distractions out of the way and help you focus on the important things.","/images/perspectives-1.jpeg","https://apps.apple.com/us/app/perspectives-to-do-list/id6476648057","To fill a hole in the task management app market, focusing on a simple, but powerful user experience.","SwiftUI, UIKit, The Composable Architecture, SQLite, CloudKit","2023 — Present","4 months to 1.0","Swift",{"b1":45,"b2":46,"b3":122},"bg-indigo-200","import Figure from \"../../components/Figure.astro\";\nimport appStore from \"../../images/perspectives-2.jpeg\";\n\n# Why\n\nThe world of to-do list apps is a dichotomy. On one hand, it seems as though there is an infinite amount of them, which makes them feel like a solved problem. On the other hand, everyone wants something different from their to-do apps, which makes them a design playground.\n\nIn the last couple of years, I tried all of the popular ones, from the default Reminders app, to [Todoist](https://todoist.com/), to the somewhat complicated [OmniFocus](https://www.omnigroup.com/omnifocus/). Everything left me wanting for something else. Reminders had the Apple polish, Todoist had simplicity, and OmniFocus had powerful constructs that let users see only what they wanted to. \n\nI wanted something that was the best of all of those worlds, but nothing quite managed to fill that niche. So I set out building one myself. I began work on Perspectives in early November 2023. Around 4 months later, in February 2024, [Perspectives](https://apps.apple.com/us/app/perspectives-to-do-list/id6476648057) was live on the App Store on iOS, iPadOS, and visionOS.\n\nPerspectives remains one of a small number of task management apps built natively for the Apple Vision Pro, and was recently featured on the visionOS App Store by Apple App Store Editorial. [^1]\n\n\u003CFigure\n    src={appStore}\n    alt=\"Featured on the visionOS App Store by App Store Editorial!\"\n    id=\"fig-1\"\n  />\n\n# Guiding Principle\nI worked on Perspectives with one principle in mind: **progressive disclosure**. It is the idea that users should be introduced to complexity as they try to do more complex things.   \n  \nTo accomplish this, the app contains four constructs: Tasks, Projects, Tags, and Perspectives.\n\n**Tasks** are the individual to-do items. They have multiple properties, including a dates, descriptions, the project it is in, the tags it is associated with, and more.\n\n**Projects** are where tasks live. Each project can have multiple tasks, but tasks can only have one project.\n\n**Tags** can be associated with tasks to help with cross-project concerns. Tasks can be tagged with multiple tags.\n\nFinally, there are **perspectives**. They are the crux of the app (hence the name), and allow users to filter tasks down to the essentials. For example, a simple one I use a lot is the “This Week” perspective, that shows me all tasks which are due this week. \n\n> Want to use Perspectives as a standard checklist? Just use projects. Want to split your tasks into low-effort and high-effort? Use tags. Want a combination of these for a complex system? Use perspectives. The power is there when you want it.\n\n# Features\nTask management apps are difficult to build. Apple’s default Reminders app already does all the basics, so I knew I needed to build something that did more. I came up with the following features with the 1.0 release:\n\n1. **Pleasing Design**: The app feels at home on iOS, iPadOS, and visionOS, while also feeling quick and nice to use.\n2. **Great Filters**: Perspectives have powerful filters that let you filter on any task properties.\n3. **Task Visibility**: Users can see only what is actionable right now, with task visibility settings that show tasks whose defer date has passed.\n4.  **Powerful Sorting and Grouping**: Each list can be sorted and grouped by any property, allowing you to users to lay their views out in a way that makes sense to them.\n5. **Sync**: Users expect their data to sync between their devices, and I worked hard to make that feel seamless.\n\nThis forms the basis of a very expressive task management solution, to which many more features can be added, many of which are already in development.\n\n# Stack and Implementation\nThe app is written almost entirely using Swift and SwiftUI. There are times that I had to dip into UIKit, but those were few and far between. SwiftUI still has some rough edges that need to be figured out, but the overall experience is really pleasant. A far cry from where it was when I first used it over four years ago. \n\nPerspectives is written entirely with [The Composable Architecture (TCA)](https://github.com/pointfreeco/swift-composable-architecture), which made so many things so much easier to reason about. The app has many components that work asynchronously, using Swift’s new concurrency tools, and TCA made it easy to avoid bugs. Much of the app is unit tested (especially the filtering logic and syncing logic), which TCA made possible. The default SwiftUI constructs simply do not have the affordances for this sort of testing, due to them being modeled, almost entirely, using reference types. \n\nLocal caching is very important in an app that is meant to work without an internet connection. To ensure that no data was lost, I needed a way to store everything on-device before sync is able to take over. I began by using the powerful [GRDB](https://github.com/groue/GRDB.swift) library, which is essentially a Swift wrapper around [SQLite](https://www.sqlite.org/). This worked for a time, but I often found that it was too complex for what was essentially just a local cache. I switched to [Boutique](https://github.com/mergesort/Boutique?tab=readme-ov-file), a library that allowed me to think about my models as just being objects in memory, with persistence handled for me. This also made it a whole lot easier to work with my syncing solution.  \n  \nFor sync, I used CloudKit through the new [CKSyncEngine](https://developer.apple.com/documentation/cloudkit/cksyncengine) API which was debuted at WWDC 2023. After getting past the teething pains, it was a breeze. However, I did run into one issue. \n\n[CloudKit](https://developer.apple.com/documentation/cloudkit), Apple’s syncing mechanism, is essentially a NoSQL database in the cloud. GRDB is a SQLite wrapper. It was very difficult to mesh these two database types in a way that was bug-free and easy to develop with. This became a real problem when relationships got involved. My app’s four constructs are intimately linked through many different relationships, and the way relationships are modeled between NoSQL databases and SQLite databases is entirely different. This was difficult enough that I switched to Boutique in the middle of development.   \n  \nIt was a big change, but was one that ended up being fairly easy to do because of how I had architected the app. The sync layer, database layer, business logic layer, and UI layer were very well separated, and switching databases only took me around 12 hours of work (including making sure my tests passed).\n\n# Results\nPerspectives is an app I never thought I’d be able to finish. For being a first full app, its scope is fairly large, and I had limited time. Overall, I am very proud of what I was able to achieve in the 1.0, and have many updates planned. Go check it out on the [App Store](https://apps.apple.com/us/app/perspectives-to-do-list/id6476648057), and if you like it, please consider leaving a review! \n\n—\n\nHere are some quick stats: \n- **Total commits**: 103 (with many rebases)\n- **First commit**: November 6, 2023\n- **App Store release commit**: February 20, 2024\n- **Days to first release**: 107 days\n- **Lines of code**: 13816 lines of Swift, and 1900 of XML/Markdown/Text, for a total of 15716 lines of code.\n\n\n[^1]:\tAlongside amazing apps, including Television and Callsheet!","src/content/projects/perspectives.mdx","7ffa9fc8db2bf531","perspectives.mdx","timelinter",{"id":127,"data":129,"body":141,"filePath":142,"digest":143,"legacyId":144,"deferredRender":18},{"title":130,"description":131,"image":132,"github":133,"deploy":134,"objective":135,"stack":136,"year":137,"timeline":138,"languages":139,"draft":18,"colors":140},"Timelinter","Timelinter is a way for managers of small teams to build schedules, based on certain constraints.","/images/tl-1.png","https://github.com/reftonull/timelinter","https://timelinter.herokuapp.com/","To make it easier for managers to make schedules, by inputting individual employees' hours, and allowing you to create shifts, while giving you errors if they are outside bounds.","Nuxt.js, Vue, Express, MongoDB","2022","4 months","JavaScript",{"b1":20,"b2":21,"b3":22},"# Background\n\n# Features\n\n# Results","src/content/projects/timelinter.mdx","46270af3e1fcdadf","timelinter.mdx","usm",{"id":145,"data":147,"body":160,"filePath":161,"digest":162,"legacyId":163,"deferredRender":18},{"title":148,"description":149,"image":150,"github":151,"objective":152,"stack":153,"year":137,"timeline":154,"languages":155,"draft":42,"colors":156},"ULC Schedule Maker","The ULC Schedule Maker is a web app designed to streamline schedule creation at the University Learning Center at New York University.","/images/usm-4.png","https://github.com/ulcnyu/ulc-schedule-maker-v2","We set out to convert the chaotic Google Calendar schedule our director prepares to one that is easily digestible on the ULC website, aggregated by course, and then by day.","Next.js, React, Express, MongoDB","3 months","TypeScript",{"b1":157,"b2":158,"b3":159},"bg-violet-300","bg-fuchsia-300","bg-pink-300","import Figure from \"../../components/Figure.astro\";\nimport PhotoGrid from \"../../components/PhotoGrid.astro\";\nimport calendars from \"../../images/usm-3.png\";\nimport output from \"../../images/usm-4.png\";\nimport courseDash from \"../../images/usm-5.png\";\nimport courseSearch from \"../../images/usm-6.png\";\nimport addCourse from \"../../images/usm-7.png\";\nimport blurbMaker from \"../../images/usm-8.png\";\n\n\u003CPhotoGrid>\n  \u003CFigure\n    src={calendars}\n    alt=\"Page to choose calendars and 'staging week', the week used to make schedules.\"\n    id=\"fig-1\"\n  />\n  \u003CFigure\n    src={output}\n    alt=\"Schedule maker output, with days and times for various courses.\"\n    id=\"fig-2\"\n  />\n  \u003CFigure\n    src={courseDash}\n    alt=\"Course dashboard for specifying courses that the ULC supports.\"\n    id=\"fig-3\"\n  />\n  \u003CFigure\n    src={courseSearch}\n    alt=\"Course search, using our database containing every course NYU offers.\"\n    id=\"fig-4\"\n  />\n  \u003CFigure\n    src={addCourse}\n    alt=\"Add Course, should our database somehow not contain the course the user is looking for.\"\n    id=\"fig-5\"\n  />\n  \u003CFigure\n    src={blurbMaker}\n    alt=\"Page to allow Learning Assistants to choose courses, so that we avoid any issues with parsing.\"\n    id=\"fig-6\"\n  />\n\u003C/PhotoGrid>\n\n# Background\n\nI work at the University Learning Center, New York University's free\npeer-tutoring organization. In my work as a Learning Assistant there, I end up\nseeing a lot of students, largely looking for help with Computer Science, Math,\nand Writing. However, that is far from all we do at the ULC. The ULC offers a\nmultitude of courses, the extent of which can be seen on our\n[website](https://www.nyu.edu/ulc). To offer the variety we do, we have a staff\nof around 60 people (and growing!)[^1]\n\nOur directors have the unenviable task of making our schedules, from\navailability we send over, and then figuring out what times each class is\navailable, to put on the website. This process is both slow, and error-prone. We\nnoticed that, despite our best efforts, there were always issues with the\nschedule on the website.\n\nThat is where the idea of the schedule maker was born. We aimed to automate this\nprocess, and we decided to do it through making a web app.\n\n# Features\n\nUnlike most university computer science projects, we knew we'd actually have\nusers. We began by considering what our directors would actually want in this\nsort of tool. The main idea was to import the Google Calendar crafted by the\ndirectors, and spit out something that could go on the website, but there were\ncomplexities abound.\n\nWe thought about a few things initially, and added things along the way[^2]:\n\n1. **Google Auth:** We would require Google login through OAuth, so that we can\n   fetch the calendar info. We'd also require auth on our end to make sure that\n   only our directors could access functionality.\n\n2. **Binning Algorithm:** The events we get from the calendar are centered\n   around tutors, and their availability. Since our tutors teach a lot of\n   different courses, we would need to change this focus, and bin according to\n   course instead. To do this we needed to create an algorithm that would do\n   these transformations for us, and merge overlapping events.\n\n3. **Support for multiple locations:** The ULC operates in multiple locations\n   across campus, so we needed to make sure that we were creating a product that\n   spits out different schedules for the different locations.\n\n4. **Source of truth:** We needed some canonical list of courses the ULC would\n   support, but required flexibility if someone wanted to tutor a course that\n   wasn't on that list.\n\n5. **Class information import:** One thing our directors really disliked doing\n   was manually updating the aforementioned course list with the correct\n   information: the course ID, canonical name, department, etc. We needed a way\n   to minimize their frustration.\n\n6. **Good UX:** The last thing we needed was for the users of our application to\n   ask us how to use it. We wanted to make the product as intuitive as possible.\n   This also meant having good documentation for our users, so that need to come\n   to us less. Finally, this meant good error messaging. Errors are bound to\n   happen with an app of this complexity, and bad errors are endlessly\n   frustrating.\n\n# Stack Considerations\n\nBeginning this project, we had a few considerations in mind. Our development\nteam was small, just three CS tutors, and we'd have limited time to work on the\nproject (we had to juggle schoolwork, work at the ULC, and now this). Therefore,\nwe needed a stack we were all fairly comfortable with.\n\nAfter much deliberation, we landed on the classic **MERN\n([MongoDB](https://www.mongodb.com/), [Express](https://expressjs.com/),\n[React.js](https://reactjs.org/), [Node](https://nodejs.org/en/)) stack, with\nNext as our meta-framework for React**. We considered using Django, for its\nintegrated auth, database, and default admin pages. However, our onboarding time\nwould be considerable, and we'd have to use Python, a language none of us are\nsuper into.\n\nWe were all into the idea of a strongly typed language, and the idea of sharing\ntypes across the backend and frontend was very compelling. That's why we ended\nup standardizing on TypeScript for the whole project, using type-safe React,\ntype-safe Express, and even type-safe database calls.\n\nThis idea, as it turns out, has been becoming more and more popular in the web\ndev space, and a lot of work is going into better tooling and developer\nexperiences in the area. Had I known about some of these projects, like\n[tRPC](https://trpc.io/), and\n[Next's great API support](https://nextjs.org/docs/api-routes/introduction), I\nthink I would've pushed for us to use them; they look magical.\n\n# Implementation\n\nImplementing the schedule maker took a lot longer than we had expected,\nespecially as the scope of the project grew. We began by pair programming a lot.\nWhile fun and largely productive, we knew we'd need to parallelize to make the\nmost of our limited time. Keeping both the frontend and backend in lock-step,\nhowever, was a challenge. Often one of us would be working on a feature without\nknowing how it would plug in to the rest of the project.\n\nThis isolated work pattern forced us to get creative. Here, we used TypeScript\nto our advantage. Every week, our first order of business was to figure out the\ntypes associated with the feature we were to build, along with any API routes,\nand the types of requests and responses associated with them. A concrete\nunderstanding of these types allowed us to split off and work separately without\nhaving to worry about whether it would fit together without breaking.\n\nThis led to us developing very rapidly, and also had the knock-on effect of\nbeing better documented than any of my previous projects. The\n[type documentation](https://github.com/ulcnyu/ulc-schedule-maker-v2/blob/b3b8eeb3fb87fa714f6fa12590b2a620a626be90/docs/types.md)\nand\n[API documentation](https://github.com/ulcnyu/ulc-schedule-maker-v2/blob/b3b8eeb3fb87fa714f6fa12590b2a620a626be90/docs/api.md)\nwe ended up with is some of the best I've seen for a small project like this.\n\nWith that overall approach, we tackled the features we wanted to implement:\n\n1. **Google Auth:** Because we were using express, we relied on\n   [passport](https://www.passportjs.org/) for authentication, despite its\n   admittedly lackluster documentation, which caused me many a headache. We\n   stored auth info both on the session, and in our MongoDB database, which we\n   were hosting on [Atlas](https://www.mongodb.com/atlas), their quick and easy\n   way to get a database running on the cloud. It has been working great for us.\n\n2. **Binning Algorithm:** The binning algorithm was reminiscent of classic\n   scheduling algorithms taught in an algorithms course. Its design involved a\n   lot of whiteboarding, and even more types. We had to deal with\n   inconsistencies in the parsing of events from Google Calendar, leading to\n   some very annoying edge cases (one especially infuriating one was the use of\n   em dashes instead of en dashes, which messed with our parser.)\n\n3. **Support for multiple locations:** This was largely a UI problem. Our UI had\n   to be intuitive enough to support multiple locations, which was somewhat\n   difficult to do, but was managed by relying on modern responsive CSS tech\n   (largely flexboxes and grids.)\n\n4. **Source of truth & class information import:** Prior to this project, the\n   closest semblance we had to a source of truth was a half broken Google Sheet\n   that contained some class information. It had been manually added to over\n   years, and was very difficult to work with. Sanitizing that data would not\n   have been fun.\n\n   Ideally, we would have liked to get course information straight from NYU.\n   However, after trying and failing multiple times to get access to NYU's class\n   API, we gave up on the idea. Instead, we used\n   [Schedge](https://github.com/A1Liu/schedge), a really nice API created by an\n   NYU alum, with information he scraped from the NYU course search site.\n\n   This ended up also solving the class information import problem: we now had\n   access to every single course taught at NYU, which we had put into our\n   database, from the Schedge API.\n\n5. **Good UX:** This was very much a process. None of us are designers, and we\n   were somewhat out of our depth. However, we ended up with something that I\n   believe is perfectly usable, and even looks pretty nice (thanks to\n   [Tailwind](https://tailwindcss.com/), which I absolutely adore.)\n\n# Results\n\nWe ended up with a product that I am fairly proud of. It solves a specific\nproblem that we faced, and sped up the creation of the schedule for the website,\nfreeing time for our directors to work on things that are more important.\nScreenshots from the project, and descriptions of them, follow.\n\nThis project was completed by [Laksh Chakraborty](/about#contact),\n[Bruce Wu](https://www.linkedin.com/in/bruce-x-wu/), and\n[Amani Hernandez](https://www.linkedin.com/in/amanihernandez/), with mentorship\nfrom [EJ Kim](https://www.linkedin.com/in/ejk483/).\n\n\u003Cdiv class=\"hidden md:inline\">\n  \u003CFigure\n    src={calendars}\n    alt=\"Page to choose calendars and 'staging week', the week used to make schedules.\"\n    id=\"fig-7\"\n  />\n  \u003CFigure\n    src={output}\n    alt=\"Schedule maker output, with days and times for various courses.\"\n    id=\"fig-8\"\n  />\n  \u003CFigure\n    src={courseDash}\n    alt=\"Course dashboard for specifying courses that the ULC supports.\"\n    id=\"fig-9\"\n  />\n  \u003CFigure\n    src={courseSearch}\n    alt=\"Course search, using our database containing every course NYU offers.\"\n    id=\"fig-10\"\n  />\n  \u003CFigure\n    src={addCourse}\n    alt=\"Add Course, should our database somehow not contain the course the user is looking for.\"\n    id=\"fig-11\"\n  />\n  \u003CFigure\n    src={blurbMaker}\n    alt=\"Page to allow Learning Assistants to choose courses, so that we avoid any issues with parsing.\"\n    id=\"fig-12\"\n  />\n\u003C/div>\n\n[^1]:\n    The return from COVID has been massive for us, and our staff has ballooned;\n    the ULC has never been more busy. Turns out students didn't quite like\n    online pedagogy. Who knew!\n\n[^2]:\n    Yay, scope creep! We did try to keep this to a minimum (I've been bitten by\n    scope creep too many times to count), but some still made its way in.","src/content/projects/usm.mdx","c170e4952d6b3100","usm.mdx"]